(window.webpackJsonp=window.webpackJsonp||[]).push([[149],{613:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("公司要求每周都要写周报，周报的大体内容就是你本周做的事情，暂时不需要所思所想所感(质量要求不高)。通常都是自己从 gitlab 的操作面板筛选出自己本周提交的日志，然后每个提交 title 复制一份。然后我傻傻的把这件事干了 2 年多了，虽然觉得应该有更便捷的方式，但是还是屈服自己懒惰。直到有那么一天，上头要求 ci 打出的包，要附带发版日志😱。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("总有那么一天，该来还是会来，只不过是时间罢了\n")])])]),s("p",[t._v("本文就是在这个需求威压中产出，由于大大解放双手，所以将这个思路整理成文，一起努力成为一名偷懒的程序员。")]),t._v(" "),s("h2",{attrs:{id:"从日志规范说起"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从日志规范说起"}},[t._v("#")]),t._v(" 从日志规范说起")]),t._v(" "),s("p",[t._v("个人通常在提交日志的时候，会在文本中添加前缀，且有以下规范：")]),t._v(" "),s("ul",[s("li",[t._v("Feat： 新功能（feature）")]),t._v(" "),s("li",[t._v("Fix： 修补bug")]),t._v(" "),s("li",[t._v("Docs： 文档（documentation）")]),t._v(" "),s("li",[t._v("Style： 格式（不影响代码运行的变动）")]),t._v(" "),s("li",[t._v("Refactor：重构（即不是新增功能，也不是修改bug的代码变动）")]),t._v(" "),s("li",[t._v("Test： 增加测试")]),t._v(" "),s("li",[t._v("Chore： 构建过程或辅助工具的变动")])]),t._v(" "),s("p",[t._v("上面的规范是是某个东家学到的，起初觉得添加前缀规范，不过是快速知道提交的大致意图。所以在某些小公司，这个优点还是无法让一个团队从意识上遵守（如果不是技术负责人拍板），总有一两个人，或者几个提交突兀出来，破窗理论很快就得到验证。对于毫无决定权的默默无闻的你只能走自己的路了。")]),t._v(" "),s("p",[t._v("以前看过一本书，里面有大致的说辞：对于戒烟的人，要让他戒烟，减量、控制吸食次数类似方法，戒烟效果不理想。更好的办法是让他意识到吸烟的危害，危害的认识越深，戒烟的成功率越高。")]),t._v(" "),s("blockquote",[s("p",[t._v("如果一个规则无法普及，很大原因是这个规则的所带来的影响无法让人深刻意识到。\n效果越好，驱动力越强。")])]),t._v(" "),s("h2",{attrs:{id:"日志实操"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日志实操"}},[t._v("#")]),t._v(" 日志实操")]),t._v(" "),s("p",[t._v("查看提交日志的命令：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log\ncommit f35f45c654e56a1d55aaca24e0e3fd3b9577bcc0 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HEAD -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" master, origin/master, origin/HEAD"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nAuthor: jihua "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1164258202")]),t._v("@qq.com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nDate:   Fri Jan "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":03:05 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" +0800\n\n    Feat: 添加详情\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n")])])]),s("p",[t._v("可能对这个命令的认识，我们就到此为止了。但通过"),s("code",[t._v("help")]),t._v("命令我们知道它不止于此。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--help")]),t._v("\n")])])]),s("p",[s("code",[t._v("git log")]),t._v(" 的功能就是浏览历史记录。可以通过许多不同的参数传递给 "),s("code",[t._v("git log")]),t._v(" 来更改日志输出，这些功能可以概括以下两类：")]),t._v(" "),s("ul",[s("li",[t._v("格式化每个提交的显示方式")]),t._v(" "),s("li",[t._v("过滤输出中包括哪些提交")])]),t._v(" "),s("h2",{attrs:{id:"格式化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#格式化"}},[t._v("#")]),t._v(" 格式化")]),t._v(" "),s("h3",{attrs:{id:"将每次提交压缩为一行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将每次提交压缩为一行"}},[t._v("#")]),t._v(" 将每次提交压缩为一行")]),t._v(" "),s("p",[t._v("它仅显示提交ID和提交消息的第一行，这对于"),s("strong",[t._v("获得项目的高级概述非常有用")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--oneline")]),t._v("\nf35f45c "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HEAD -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" master, origin/master, origin/HEAD"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" Feat: 添加详情\n199a0ce "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tag: state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" Feat: 状态不同步问题\n6e2c7d4 Feat: 添加文件\n")])])]),s("h3",{attrs:{id:"显示指向每个提交的所有引用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#显示指向每个提交的所有引用"}},[t._v("#")]),t._v(" 显示指向每个提交的所有引用")]),t._v(" "),s("p",[t._v("很多时候了解每个提交与哪个分支或标签相关联很有用，使你"),s("strong",[t._v("可以更全面地了解存储库的逻辑结构")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--oneline")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--decorate")]),t._v("\n0e25143 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HEAD, master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" Merge branch "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'feature'")]),t._v("\nad8621a "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("feature"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" Fix: fix a bug "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the feature\n16b36c6 Feat: Add a new feature\n23ad9ad "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tag: v0.9"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" Feat: Add the initial code base\n")])])]),s("h3",{attrs:{id:"每次提交时显示差异"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#每次提交时显示差异"}},[t._v("#")]),t._v(" 每次提交时显示差异")]),t._v(" "),s("p",[s("code",[t._v("--stat")]),t._v(" 选项显示每次提交更改的每个文件的插入和删除次数（请注意，修改一行表示为1次插入和1次删除），这使你了解可以在何处找到每个提交的更改。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--stat")]),t._v("\ncommit f2a238924e89ca1d4947662928218a06d39068c3\nAuthor: John "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("john@example.com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nDate: Fri Jun "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(":30:28 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2014")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-0500")]),t._v("\nAdd a new feature\nhello.py "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("105")]),t._v(" ++++++++++++++++++++++++-----------------\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" changed, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("67")]),t._v(" insertion"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("38")]),t._v(" deletions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("-"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("code",[t._v("-p")]),t._v(" 查看每个提交所引入的实际更改。")]),t._v(" "),s("h3",{attrs:{id:"简短日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简短日志"}},[t._v("#")]),t._v(" 简短日志")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" shortlog\nMary "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\nFix a bug "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the feature\nFix a serious security hole "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" our framework\nJohn "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\nAdd the initial code base\nAdd a new feature\nMerge branch "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'feature'")]),t._v("\n")])])]),s("p",[t._v("它按作者对每个提交进行分组，并显示每个提交消息的第一行。 这是查看谁在做什么的一种简单方法。")]),t._v(" "),s("h3",{attrs:{id:"自定义格式输出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义格式输出"}},[t._v("#")]),t._v(" 自定义格式输出")]),t._v(" "),s("p",[t._v("可以使用 "),s("code",[t._v("--pretty = format：“<string>”")]),t._v("选项。这样可以使用 printf 样式的占位符来显示每个提交。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pretty")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("format:"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%cn:%s(%cd)"')]),t._v("\njihua:Feat: 添加详情"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Fri Jan "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":03:05 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" +0800"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\njihua:Feat: 状态不同步问题"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Sun Jan "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":19:48 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" +0800"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\njihua:Feat: 添加文件"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Sun Jan "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(":30:07 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" +0800"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\njihua:Feat: 修改"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Sun Jan "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":43:58 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" +0800"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\njihua:Feat: 修改"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Wed Jan "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":06:06 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" +0800"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"过滤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#过滤"}},[t._v("#")]),t._v(" 过滤")]),t._v(" "),s("h3",{attrs:{id:"限制显示的提交数量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#限制显示的提交数量"}},[t._v("#")]),t._v(" 限制显示的提交数量")]),t._v(" "),s("p",[t._v("通过 "),s("code",[t._v("-<n>")]),t._v(" 选项来限制 git log 的输出数量")]),t._v(" "),s("p",[t._v("以下命令将仅显示3个最新提交")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-3")]),t._v("\n")])])]),s("h3",{attrs:{id:"查找特定时间范围内的提交"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查找特定时间范围内的提交"}},[t._v("#")]),t._v(" 查找特定时间范围内的提交")]),t._v(" "),s("p",[t._v("可以使用"),s("code",[t._v("--after")]),t._v("或"),s("code",[t._v("--before")]),t._v("标志来按日期过滤提交")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--after")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2021-1-1"')]),t._v("\n")])])]),s("p",[t._v("还可以传递相对引用，例如“ 1周前”和“昨天”：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--after")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yesterday"')]),t._v("\n")])])]),s("p",[t._v("要搜索在两个日期之间创建的提交，可以同时提供-之前和-之后的日期")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--after")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2021-1-1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--before")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2021-1-20"')]),t._v("\n")])])]),s("h3",{attrs:{id:"仅查找由特定用户创建的提交"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#仅查找由特定用户创建的提交"}},[t._v("#")]),t._v(" 仅查找由特定用户创建的提交")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--author")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lai"')]),t._v("\n")])])]),s("p",[t._v("还可以使用正则表达式来创建更复杂的搜索，以下命令搜索Mary或John的提交")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--author")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"John\\|Mary"')]),t._v("\n")])])]),s("h3",{attrs:{id:"按文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#按文件"}},[t._v("#")]),t._v(" 按文件")]),t._v(" "),s("p",[t._v("要显示与文件相关的历史记录，传递文件路径即可。 例如，以下代码返回所有影响 foo.py 或 bar.py 文件的提交")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log -- foo.py bar.py\n")])])]),s("h3",{attrs:{id:"按范围"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#按范围"}},[t._v("#")]),t._v(" 按范围")]),t._v(" "),s("p",[t._v("以将一系列提交提交给 git log，以仅显示该范围内包含的提交。当你使用分支引用作为参数时，此命令特别有用。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("feature \n")])])]),s("p",[t._v("以上是对 git log 一些参数的使用介绍，还有更多参数的使用，可以参考文档 "),s("a",{attrs:{href:"https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E6%9F%A5%E7%9C%8B%E6%8F%90%E4%BA%A4%E5%8E%86%E5%8F%B2",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("查看提交历史"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"实战生成周报"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实战生成周报"}},[t._v("#")]),t._v(" 实战生成周报")]),t._v(" "),s("p",[t._v("功能需求：获取用户lai在本周的代码日志到文件 log.txt 中，不包括 merge 的信息，输出格式如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("* Feat: 添加详情(2021-01-22)\n")])])]),s("p",[t._v("那么要完成这个功能，我们要做的有：")]),t._v(" "),s("ul",[s("li",[t._v("获取到 lai 的日志")]),t._v(" "),s("li",[t._v("获取到本周的日志")]),t._v(" "),s("li",[t._v("自定义日志的输出")]),t._v(" "),s("li",[t._v("去除 merge 信息")]),t._v(" "),s("li",[t._v("输出到文件 log.txt 中")])]),t._v(" "),s("p",[t._v("所以，整个命令：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" log --no-merges "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--author")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("lai "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--since")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".weeks "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pretty")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("format:"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'* %s(%ad)'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--date")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("short "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ~/Desktop/log.txt\n")])])]),s("p",[s("code",[t._v("log.txt")]),t._v(" 的内容类似：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("* Chore: 版本升级到 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.5")]),t._v(".0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-23"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n* Chore: 自动化打包脚本优化"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-23"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n* Chore: 脚本优化, 发版的时候强制设置环境，防止受其他分支改动影响"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-23"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n* Feat: h5 接口对接"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-22"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n* Fix: 解决数组越界问题"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-22"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n* Doct: README 文档修改"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-22"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n* Refactor：重构 WebController "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-22"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("那么这个功能就做完成了。但你以为就结束了么？")]),t._v(" "),s("h2",{attrs:{id:"更进一步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更进一步"}},[t._v("#")]),t._v(" 更进一步")]),t._v(" "),s("p",[t._v("对于文章开头提到的提交规范，我们说对于规范的益处认识不足。当我们将日志搜集到 "),s("code",[t._v("log.txt")]),t._v(" 中，如果就怎么给上头审阅的，可能会被打回来，因为不能一眼知道，哪些是新增，哪些是修改，哪些是优化。所以我们必须给日志进行整理，不能就这么直白的输出。希望看到：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 新增")]),t._v("\n* h5 接口对接"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-22"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## bug")]),t._v("\n* 解决数组越界问题"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-22"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 优化")]),t._v("\n* 重构 WebController "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-22"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 文档")]),t._v("\n* README 文档修改"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-22"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 其他")]),t._v("\n* 版本升级到 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.5")]),t._v(".0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-23"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n* 自动化打包脚本优化"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-23"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n* 脚本优化, 发版的时候强制设置环境，防止受其他分支改动影响"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-23"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("那么本质上就是对日志进行归类：")]),t._v(" "),s("ul",[s("li",[t._v("Feat => 新增")]),t._v(" "),s("li",[t._v("Fix => bug")]),t._v(" "),s("li",[t._v("Refactor => 优化")]),t._v(" "),s("li",[t._v("Doct => 文档")]),t._v(" "),s("li",[t._v("Chore => 其他")])]),t._v(" "),s("p",[t._v("可以直接通过规范的前缀将日志进行分类。这就是日志规范化的另一个好处，可以统计提交。")]),t._v(" "),s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" os\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" json\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pathlib "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Path\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sys\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" getopt\n\nargv "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("argv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'product'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# preview | product (预览模式和发版模式)")]),t._v("\n \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    opts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" getopt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getopt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"m:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 短选项模式")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"错误，不支持m:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" opt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arg "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" opts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" opt "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-m'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" arg\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 最开始收集日志的 commitid")]),t._v("\nstart_commit_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxxw454344346"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否是上传到线上")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果是上传到线上，则日志从 start_commit_id 开始获取")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果是日常发版，则日志从当前版本的上一次打包的 commit 开始")]),t._v("\nis_online_release "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'product'")]),t._v("\n\nhistory_commit_file "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%s/package-logs.json"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("home"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("init_history_commit_file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("history_commit_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("history_commit_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'w'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dump"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"version logs"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("write_note")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'release-note.txt'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'w'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        content "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git_shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("git_command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("popen"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("git_command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_history_commit_id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("branch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("history_commit_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'r'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("branch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("save_history_commit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("branch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" commit_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("history_commit_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'r'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("history_commit_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'w'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" ff"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("branch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" commit_id\n        json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dump"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ff"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("pretty_log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Feat => 新增")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Fix => bug")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Refactor => 优化")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Doct => 文档")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Chore => 其他")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n\ninit_history_commit_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取当前分支名")]),t._v("\ngit_branch "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" git_shell"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'git rev-parse --abbrev-ref HEAD'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" is_online_release"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    history_commit_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_history_commit_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("git_branch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" history_commit_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        start_commit_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" history_commit_id\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当前分支的最后一个提交ID")]),t._v("\nlast_commit_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" git_shell"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'git rev-parse HEAD'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nlog_cmd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git log %s..%s --date=short --no-merges --pretty="')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("start_commit_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" last_commit_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f\"format:'* %s(%an)'\"")])]),t._v("\ngit_logs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" git_shell"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("log_cmd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取到日志后，需要对日志进行归类，便于阅读")]),t._v("\ngit_logs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pretty_log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("git_logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 写入日志")]),t._v("\nwrite_note"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("git_logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" is_online_release"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    save_history_commit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("git_branch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" last_commit_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'✅ 日志生成完成'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("code",[t._v("pretty_log")]),t._v(" 并没有提供实现代码，读者可以自己填充🤗。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("努力成为一名爱偷懒的程序员💪，珍爱生命\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);