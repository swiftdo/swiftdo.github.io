(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{768:function(t,a,s){"use strict";s.r(a);var n=s(8),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("在上文《"),s("a",{attrs:{href:"https://oldbird.run/flutter/github-actions-build-flutter-ios.html",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("Github Actions 免费构建 Flutter iOS 包"),s("OutboundLink")],1),t._v("》中，我们完成了 Flutter 基于 Github Actions 实现 iOS 的自动化打包。\n那么本文将继续完成 Android 的自动化打包。")]),t._v(" "),s("p",[t._v("Android 的打包相对 iOS 来说，容易很多，所以本文不会过多阐述重复步骤。")]),t._v(" "),s("h2",{attrs:{id:"步骤概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤概述"}},[t._v("#")]),t._v(" 步骤概述")]),t._v(" "),s("p",[t._v("要实现构建出 Flutter Android 包的目标，将执行以下步骤：")]),t._v(" "),s("ul",[s("li",[t._v("配置 release 打包环境")]),t._v(" "),s("li",[t._v("指定正确的 Flutter 版本")]),t._v(" "),s("li",[t._v("拉取 flutter packages")]),t._v(" "),s("li",[t._v("构建应用程序为 apk")]),t._v(" "),s("li",[t._v("上传到蒲公英")]),t._v(" "),s("li",[t._v("分享给你的用户")])]),t._v(" "),s("p",[t._v("为了完成顺利构建，请先完成 "),s("a",{attrs:{href:"https://flutterchina.club/android-release/",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("发布 Android 版 APP"),s("OutboundLink")],1),t._v(" 的配置:")]),t._v(" "),s("ul",[s("li",[t._v("app 签名")]),t._v(" "),s("li",[t._v("在 gradle 中配置签名")])]),t._v(" "),s("p",[t._v("本文将 "),s("code",[t._v("key.properties")]),t._v(" 放在 "),s("code",[t._v("<app dir>/android/")]),t._v(" 目录下，将 "),s("code",[t._v("key.jks")]),t._v(" 放在 "),s("code",[t._v("<app dir>/android/app/")]),t._v(" 目录下。")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"","data-src":"http://blog.oldbird.run/mweb/16451653664048.jpg",loading:"lazy"}})]),t._v(" "),s("h2",{attrs:{id:"配置-secrets"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-secrets"}},[t._v("#")]),t._v(" 配置 secrets")]),t._v(" "),s("p",[t._v("我们规划将"),s("code",[t._v("key.properties")]),t._v("的 base64 字符串在 secrets 的 key 为 "),s("code",[t._v("KEY_PROPERTIES")]),t._v("。\n将"),s("code",[t._v("key.jks")]),t._v("的 base64 字符串存的 key 为 "),s("code",[t._v("KEYSTORE_BASE64")]),t._v("。")]),t._v(" "),s("blockquote",[s("p",[t._v("快速获取文件的 base64， 例如："),s("code",[t._v("base64 key.jks | pbcopy")]),t._v("。这时候 key.jks 文件的 base64 字符串已保存在你的剪贴板中，可直接粘贴。")])]),t._v(" "),s("h2",{attrs:{id:"构建配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建配置"}},[t._v("#")]),t._v(" 构建配置")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Flutter_Android\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pull_request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build_android")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Checkout the code\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v2\n\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Setup Java to compile Android project\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("java@v1\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("java-version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"12.x"')]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Install and set Flutter version\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" subosito/flutter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@v2\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("flutter-version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2.10.0"')]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Create the Keystore\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KEYSTORE_BASE64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.KEYSTORE_BASE64 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KEY_PROPERTIES")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.KEY_PROPERTIES "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n          # import keystore from secrets\n          ls -all\n          echo $KEYSTORE_BASE64 | base64 -di > android/app/key.jks\n          echo $KEY_PROPERTIES | base64 -di > android/key.properties")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Restore packages\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flutter pub get\n\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Build Android App Bundle\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flutter build apk "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("release\n\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Upload PGYER File\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pgyer\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xtayga/upload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pgyer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@master\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//www.pgyer.com/apiv2/app/upload\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("forms")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"_api_key":"${{ secrets.PGY_KEY }}","buildName":"RSSAndroid"}\'')]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fileForms")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"file":"build/app/outputs/apk/release/app-release.apk"}\'')]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Publish Android Artefacts\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/upload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("artifact@v1\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" release"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("aab\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build/app/outputs/apk/release/app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("release.apk\n")])])]),s("p",[t._v("整个构建过程相对简单，为了方便下载，做了上传蒲公英的功能。通过使用 "),s("a",{attrs:{href:"https://github.com/xtayga/upload-pgyer-action",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("xtayga/upload-pgyer-action@master"),s("OutboundLink")],1),t._v(" 这个第三方 Action，我们可以快速完成包的上传。")]),t._v(" "),s("h2",{attrs:{id:"最后"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[t._v("#")]),t._v(" 最后")]),t._v(" "),s("p",[t._v("完成的构建配置，您可以在 Github 中找到示例代码："),s("a",{attrs:{href:"https://github.com/swiftdo/flutter_best_practice",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("flutter_best_practice"),s("OutboundLink")],1),t._v("，这是个使用 river_pod 进行状态管理的 RSS 应用。")]),t._v(" "),s("h2",{attrs:{id:"参阅"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参阅"}},[t._v("#")]),t._v(" 参阅")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://flutterchina.club/android-release/",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("发布 Android 版 APP"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/xtayga/upload-pgyer-action",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("上传蒲公英 xtayga/upload-pgyer-action"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);