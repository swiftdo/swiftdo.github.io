(window.webpackJsonp=window.webpackJsonp||[]).push([[148],{719:function(t,s,a){"use strict";a.r(s);var e=a(2),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("SliverAppBar 控件可以实现页面头部区域展开、折叠的效果。")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"","data-src":"http://blog.oldbird.run/mweb/467322-20200118181534530-1611648292.gif",loading:"lazy"}})]),t._v(" "),s("p",[t._v("想更具体了解 SliverAppBar 使用，可参考 "),s("a",{attrs:{href:"https://codechina.csdn.net/mirrors/yechaoa/flutter_sliverappbar",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("yechaoa/flutter_sliverappbar"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("SliverAppBar 联动效果的控制的还是比较薄弱的。在真正产品开发中，联动需求是非常奇葩的。")]),t._v(" "),s("p",[t._v("比如")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("滚动到一定高度的时候改变状态栏文字颜色")])]),t._v(" "),s("li",[s("p",[t._v("滚动的时候，实现背景色渐变：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"","data-src":"http://blog.oldbird.run/mweb/gradient_background.gif",loading:"lazy"}})])]),t._v(" "),s("li",[s("p",[t._v("某个元素的位置移动等等")])])]),t._v(" "),s("p",[t._v("为了深度自定义联动效果，Flutter 给你提供了 "),s("code",[t._v("SliverPersistentHeader")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"sliverpersistentheader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sliverpersistentheader"}},[t._v("#")]),t._v(" SliverPersistentHeader")]),t._v(" "),s("blockquote",[s("p",[t._v("Creates a sliver that varies its size when it is scrolled to the start of a viewport.")])]),t._v(" "),s("p",[t._v("SliverAppBar 的动效其实也是基于 "),s("code",[t._v("SliverPersistentHeader")]),t._v(" 实现的。")]),t._v(" "),s("p",[s("strong",[t._v("越底层，可操控的手段越多")])]),t._v(" "),s("h3",{attrs:{id:"sliverpersistentheader-属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sliverpersistentheader-属性"}},[t._v("#")]),t._v(" SliverPersistentHeader 属性")]),t._v(" "),s("ul",[s("li",[t._v("delegate：SliverPersistentHeaderDelegate")]),t._v(" "),s("li",[t._v("pinned 收缩到最小高度的时候是否可见\n"),s("ul",[s("li",[t._v("true：SliverPersistentHeader 会以折叠高度固定显示在头部，")]),t._v(" "),s("li",[t._v("false：缩小到折叠高度后滑出页面")])])]),t._v(" "),s("li",[t._v("floating: 是否下滑的同时是否先展示")])]),t._v(" "),s("p",[t._v("各种参数配置的效果可参考这位大佬的文章： "),s("a",{attrs:{href:"https://juejin.cn/post/6887396184015208461#heading-5",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("SliverPersistentHeader 使用指南"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"sliverpersistentheaderdelegate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sliverpersistentheaderdelegate"}},[t._v("#")]),t._v(" SliverPersistentHeaderDelegate")]),t._v(" "),s("p",[t._v("SliverPersistentHeader 的核心就是使用 SliverPersistentHeaderDelegate，我们需要对其进行子类化，也是非常容易的：")]),t._v(" "),s("div",{staticClass:"language-dart extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dart"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PersistentHeaderBuilder")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SliverPersistentHeaderDelegate")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" double max"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" double min"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Widget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BuildContext")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" double offset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bool overlapsContent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" builder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PersistentHeaderBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("max "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("120")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("min "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" required "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("builder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("max "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" min "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" builder "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token metadata function"}},[t._v("@override")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Widget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BuildContext")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" double shrinkOffset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bool overlapsContent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" shrinkOffset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" overlapsContent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token metadata function"}},[t._v("@override")]),t._v("\n  double "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" maxExtent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" max"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token metadata function"}},[t._v("@override")]),t._v("\n  double "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" minExtent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" min"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token metadata function"}},[t._v("@override")]),t._v("\n  bool "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("shouldRebuild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("covariant")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PersistentHeaderBuilder")]),t._v(" oldDelegate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n      max "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" oldDelegate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("max "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n      min "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" oldDelegate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("min "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n      builder "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" oldDelegate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("builder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("要啥都从外部传进来，非常简单的实现了一个通用的 delegete。")]),t._v(" "),s("h2",{attrs:{id:"使用自定义的-persistentheaderbuilder"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用自定义的-persistentheaderbuilder"}},[t._v("#")]),t._v(" 使用自定义的 PersistentHeaderBuilder")]),t._v(" "),s("div",{staticClass:"language-dart extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dart"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token metadata function"}},[t._v("@override")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Widget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BuildContext")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 状态栏高度")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" navh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navBarHeight "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusBarHeight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SliverPersistentHeader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        pinned"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        floating"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        delegate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PersistentHeaderBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        min"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" navh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        max"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" maxh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        builder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" offset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" overlapsContent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AnnotatedRegion")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SystemUiOverlayStyle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                     offset "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" navh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SystemUiOverlayStyle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dark "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SystemUiOverlayStyle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("light"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                child"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_buildContent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" offset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" overlapsContent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Widget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_buildContent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BuildContext")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" double offset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bool overlapsContent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 有了 offset 你可以做任何动效了")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("使用也非常简单，你想做啥就设置啥。样例中，我们在滚动偏移量超过了导航栏的高度，会去改变状态栏的颜色。\n因为拿到 "),s("code",[t._v("offset")]),t._v(", 所以我们可以根据这个 offset 做任何联动效果了。")]),t._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("SliverPersistentHeader 可以很好的控制联动效果，因为可以从 delegate 中获取到 offset。SliverAppBar 其内部已经实现了 offset 相关的动效，给外部的更多是内容填充。")]),t._v(" "),s("p",[t._v("要实现类似复杂联动动画，也就 SliverPersistentHeader 不可。原理上能监听到滚动的 offset，就可以实现类似效果。所以通过监听 Scrollview 的滚动事件也是可以的(没深入底层代码，说不好也是这么干的)。")]),t._v(" "),s("p",[t._v("背景渐变效果的实现："),s("a",{attrs:{href:"https://github.com/miroslava-podybailo/flutter_sliver_header_delegate",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("miroslava-podybailo/flutter_sliver_header_delegate"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);