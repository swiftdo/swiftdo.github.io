(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{787:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("在 Ubantu20.04 中，安装宝塔面板，部署 Flask.")]),s._v(" "),a("h2",{attrs:{id:"环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[s._v("#")]),s._v(" 环境")]),s._v(" "),a("blockquote",[a("p",[s._v("python 3.8.10\nubuntu 20.04")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" build-essential python3-dev\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" python3-venv\n$ python3 -m venv venv\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_ALL")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"en_US.UTF-8"')]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LC_CTYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"en_US.UTF-8"')]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" dpkg-reconfigure locales\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入虚拟环境")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" venv/bin/activate\n$ pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" wheel\n$ pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" uwsgi\n$ pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -r requirements.txt\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出虚拟环境")]),s._v("\n$ deactivate\n")])])]),a("h2",{attrs:{id:"配置-uwsgi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-uwsgi"}},[s._v("#")]),s._v(" 配置 uwsgi")]),s._v(" "),a("p",[s._v("在应用根目录创建 config.ini 文件，内容如下")]),s._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token header"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("uwsgi")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# uwsgi 启动时所使用的地址与端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("socket")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("127.0.0.1:8386")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指向网站目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("chdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/www/wwwroot/www.itswcg.site")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# python 启动程序文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("wsgi-file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("main.py")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# python 程序内用以启动的 application 变量名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("callable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("app")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 处理器数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("processes")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 线程数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("threads")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#状态检测地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("stats")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("127.0.0.1:9191")]),s._v("\n")])])]),a("h2",{attrs:{id:"配置-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-nginx"}},[s._v("#")]),s._v(" 配置 nginx")]),s._v(" "),a("p",[s._v("在宝塔面板中，管理网站，设置，配置文件修改如下，\n或者在/www/server/panel/vhost/nginx/"),a("name",[s._v(".conf 下修改")])],1),s._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 如有多个web应用，都是80端口监听\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" resume.itswcg.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#地址")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("      uwsgi_params")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("uwsgi_pass")]),s._v("   127.0.0.1:8386")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指向uwsgi 所应用的内部地址,所有请求将转发给uwsgi 处理")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("uwsgi_param")]),s._v(" UWSGI_PYHOME /www/wwwroot/www.itswcg.site/venv")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指向虚拟环境目录")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("uwsgi_param")]),s._v(" UWSGI_CHDIR  /www/wwwroot/www.itswcg.site")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指向网站根目录")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("uwsgi_param")]),s._v(" UWSGI_SCRIPT main:app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定启动程序")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h2",{attrs:{id:"配置-supervisor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-supervisor"}},[s._v("#")]),s._v(" 配置 supervisor")]),s._v(" "),a("p",[s._v("supervisor 能同时启动多个应用，能自动重启应用，保证可用性。")]),s._v(" "),a("p",[s._v("安装")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" supervisor\n")])])]),a("p",[s._v("在 /etc/supervisor/conf.d 下添加"),a("name",[s._v(".conf 文件(resume.conf)，内容如下")])],1),s._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("[program:resume] "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#resume是<name>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##注意项目目录和uwsgi的配置文件地址")]),s._v("\ncommand=/www/wwwroot/www.itswcg.site/venv/bin/uwsgi /www/wwwroot/www.itswcg.site/config.ini\ndirectory=/www/wwwroot/www.itswcg.site\nautostart=true\nautorestart=true\nuser = root\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##log文件的位置")]),s._v("\nstdout_logfile=/var/log/supervisor/%(program_name)-stdout.log\nstderr_logfile=/var/log/supervisor/%(program_name)-stderr.log\n")])])]),a("p",[s._v("启动")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("supervisord -c /etc/supervisor/supervisord.conf\n")])])]),a("p",[s._v("客户端管理")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("supervisorctl\n")])])]),a("p",[s._v("这样你就不用每次重启时都运行")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$uwsgi config.ini\n")])])]),a("p",[s._v("supervisor 帮你自动重启\n还有别忘了在宝塔面板安全中，放行端口。")]),s._v(" "),a("p",[s._v("几个常用命令")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" supervisorctl reread\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" supervisorctl restart all\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" supervisorctl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" hello\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" supervisorctl start hello\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);