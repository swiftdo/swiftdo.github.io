(window.webpackJsonp=window.webpackJsonp||[]).push([[286],{746:function(t,s,a){"use strict";a.r(s);var e=a(2),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("在 Kubernetes 中，存活探针（Liveness Probe）用于检测 Pod 中容器是否处于健康状态。如果探针检测到容器不健康，Kubernetes 会重新启动该容器。通过这种机制，可以确保应用在发生故障时自动恢复。")]),t._v(" "),s("p",[t._v("以下是一个带有存活探针的 Pod YAML 配置示例：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("with"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("liveness"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("probe  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Pod 名称")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("container  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器名称")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用的镜像")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("livenessProbe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("httpGet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# HTTP 请求类型的存活探针")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /healthz  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 探针检测的路径")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 探针检测的端口")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initialDelaySeconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器启动后等待 5 秒才进行第一次检测")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("periodSeconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每 10 秒检测一次")]),t._v("\n")])])]),s("h2",{attrs:{id:"存活探针的关键配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#存活探针的关键配置"}},[t._v("#")]),t._v(" 存活探针的关键配置：")]),t._v(" "),s("ul",[s("li",[t._v("livenessProbe: 定义容器的存活探针。")]),t._v(" "),s("li",[t._v("httpGet: 使用 HTTP GET 请求进行健康检查\n"),s("ul",[s("li",[t._v("path: 探针检测的路径，比如 /healthz。")]),t._v(" "),s("li",[t._v("port: 探针检测的端口，这里是 80 端口。")])])]),t._v(" "),s("li",[t._v("initialDelaySeconds: 容器启动后首次探测前的延迟时间（秒）。通常给应用足够时间初始化。")]),t._v(" "),s("li",[t._v("periodSeconds: 每次检查的时间间隔（秒），这里设为 10 秒。")])]),t._v(" "),s("h2",{attrs:{id:"常见的探针类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见的探针类型"}},[t._v("#")]),t._v(" 常见的探针类型：")]),t._v(" "),s("ul",[s("li",[t._v("HTTP GET 探针：通过 HTTP GET 请求一个 URL 路径，检测返回的状态码是否为 200-399 之间，来判断是否存活。")]),t._v(" "),s("li",[t._v("TCP 探针：通过 TCP 端口来检测容器是否存活。")]),t._v(" "),s("li",[t._v("命令探针（exec）：通过执行一个命令，检测命令的退出码，0 表示成功，非 0 表示失败。")])]),t._v(" "),s("h3",{attrs:{id:"tcp-探针示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tcp-探针示例"}},[t._v("#")]),t._v(" TCP 探针示例")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("livenessProbe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tcpSocket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 通过 TCP 连接 3306 端口")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initialDelaySeconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("periodSeconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n")])])]),s("h3",{attrs:{id:"exec-探针示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#exec-探针示例"}},[t._v("#")]),t._v(" exec 探针示例：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("livenessProbe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cat\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /tmp/healthy  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行命令，检测文件是否存在")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initialDelaySeconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("periodSeconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n")])])]),s("p",[t._v("存活探针可以帮助保持应用的可靠性，确保容器在运行过程中遇到问题时能够自动恢复。")])])}),[],!1,null,null,null);s.default=n.exports}}]);