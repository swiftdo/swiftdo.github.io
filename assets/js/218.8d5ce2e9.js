(window.webpackJsonp=window.webpackJsonp||[]).push([[218],{682:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("在开发 "),s("strong",[t._v("iOS 小组件 (Widget)")]),t._v(" 时，"),s("code",[t._v("placeholder")]),t._v("、"),s("code",[t._v("getSnapshot")]),t._v(" 和 "),s("code",[t._v("getTimeline")]),t._v(" 是 "),s("strong",[t._v("WidgetKit")]),t._v(" 的核心方法，它们的调用时机关系到组件的"),s("strong",[t._v("加载状态")]),t._v("和"),s("strong",[t._v("数据刷新")]),t._v("流程。下面是详细说明它们的调用时机及作用：")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"_1-placeholder-的调用时机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-placeholder-的调用时机"}},[t._v("#")]),t._v(" "),s("strong",[t._v("1. placeholder 的调用时机")])]),t._v(" "),s("p",[s("code",[t._v("placeholder")]),t._v(" 方法用于"),s("strong",[t._v("占位内容")]),t._v("，即小组件在加载完成前展示的默认视图。")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("什么时候调用？")])]),t._v(" "),s("ul",[s("li",[t._v("在小组件刚添加到主屏幕时。")]),t._v(" "),s("li",[t._v("系统或 Widget 需要"),s("strong",[t._v("快速展示")]),t._v("内容（通常在数据尚未加载时）。")]),t._v(" "),s("li",[t._v("在 "),s("strong",[t._v("Widget 预览模式")]),t._v("（如用户在添加小组件时浏览不同尺寸的预览）。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("适用场景：")])]),t._v(" "),s("ul",[s("li",[t._v("使用占位符数据来显示小组件的基本布局，不需要实际数据。")])])])]),t._v(" "),s("p",[s("strong",[t._v("示例代码：")])]),t._v(" "),s("div",{staticClass:"language-swift extra-class"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("placeholder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleEntry")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleEntry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"加载中..."')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"_2-getsnapshot-的调用时机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-getsnapshot-的调用时机"}},[t._v("#")]),t._v(" "),s("strong",[t._v("2. getSnapshot 的调用时机")])]),t._v(" "),s("p",[s("code",[t._v("getSnapshot")]),t._v(" 方法用于生成"),s("strong",[t._v("静态快照")]),t._v("，即当系统需要"),s("strong",[t._v("快速加载和展示")]),t._v("当前视图时使用。")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("什么时候调用？")])]),t._v(" "),s("ul",[s("li",[t._v("当用户"),s("strong",[t._v("查看小组件的预览")]),t._v("（例如在主屏幕上长按时）。")]),t._v(" "),s("li",[t._v("当系统"),s("strong",[t._v("无法立即获取完整数据")]),t._v("，需要快速显示快照。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("特点：")])]),t._v(" "),s("ul",[s("li",[t._v("该方法的执行速度需要尽量"),s("strong",[t._v("快")]),t._v("，通常返回"),s("strong",[t._v("最近一次的缓存数据")]),t._v("。")]),t._v(" "),s("li",[t._v("在一些静态内容的小组件中，"),s("code",[t._v("getSnapshot")]),t._v(" 可能会频繁调用。")])])])]),t._v(" "),s("p",[s("strong",[t._v("示例代码：")])]),t._v(" "),s("div",{staticClass:"language-swift extra-class"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("getSnapshot")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" completion"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attribute atrule"}},[t._v("@escaping")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleEntry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" entry "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleEntry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"快照数据"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("completion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("entry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"_3-gettimeline-的调用时机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-gettimeline-的调用时机"}},[t._v("#")]),t._v(" "),s("strong",[t._v("3. getTimeline 的调用时机")])]),t._v(" "),s("p",[s("code",[t._v("getTimeline")]),t._v(" 是"),s("strong",[t._v("核心数据更新方法")]),t._v("，用于生成一系列的时间条目 ("),s("code",[t._v("TimelineEntry")]),t._v(")，并决定小组件"),s("strong",[t._v("何时刷新")]),t._v("。")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("什么时候调用？")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("首次加载")]),t._v("小组件时。")]),t._v(" "),s("li",[s("strong",[t._v("定时刷新")]),t._v("，由你通过时间表或策略 ("),s("code",[t._v("Timeline")]),t._v(") 控制刷新频率。")]),t._v(" "),s("li",[t._v("在"),s("strong",[t._v("用户交互或系统事件触发")]),t._v("刷新时。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("特点：")])]),t._v(" "),s("ul",[s("li",[t._v("你可以通过设置"),s("strong",[t._v("刷新策略")]),t._v("（如固定时间间隔、到期后刷新等）来控制更新频率。")]),t._v(" "),s("li",[t._v("合理控制刷新时间非常重要，频繁更新会影响性能和耗电量。")])])])]),t._v(" "),s("p",[s("strong",[t._v("示例代码：")])]),t._v(" "),s("div",{staticClass:"language-swift extra-class"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("getTimeline")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" completion"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attribute atrule"}},[t._v("@escaping")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Timeline")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleEntry")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" currentDate "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextUpdate "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Calendar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("byAdding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("minute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" to"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" currentDate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" entry "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleEntry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" currentDate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"最新数据"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" timeline "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Timeline")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("entries"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("entry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" policy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("after")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextUpdate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("completion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timeline"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"调用顺序与流程图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调用顺序与流程图"}},[t._v("#")]),t._v(" "),s("strong",[t._v("调用顺序与流程图")])]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("首次加载小组件：")])]),t._v(" "),s("ul",[s("li",[t._v("调用 "),s("code",[t._v("placeholder")]),t._v(" 显示占位内容 → 调用 "),s("code",[t._v("getSnapshot")]),t._v(" 展示快照 → 调用 "),s("code",[t._v("getTimeline")]),t._v(" 获取完整数据并更新。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("用户查看预览或长按：")])]),t._v(" "),s("ul",[s("li",[t._v("调用 "),s("code",[t._v("getSnapshot")]),t._v(" 快速加载当前状态。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("定时或事件触发更新：")])]),t._v(" "),s("ul",[s("li",[t._v("调用 "),s("code",[t._v("getTimeline")]),t._v(" 更新数据并生成新的时间表。")])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" "),s("strong",[t._v("总结")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("方法")])]),t._v(" "),s("th",[s("strong",[t._v("调用时机")])]),t._v(" "),s("th",[s("strong",[t._v("作用")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("placeholder")])]),t._v(" "),s("td",[t._v("小组件加载或预览时")]),t._v(" "),s("td",[t._v("展示基本布局的占位符，不含实际数据")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("getSnapshot")])]),t._v(" "),s("td",[t._v("预览模式或需要快速展示内容时")]),t._v(" "),s("td",[t._v("提供当前状态的快照，速度快，使用缓存数据")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("getTimeline")])]),t._v(" "),s("td",[t._v("数据刷新或系统定时触发时")]),t._v(" "),s("td",[t._v("生成时间表并决定何时刷新数据")])])])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("通过合理使用这三个方法，你可以确保小组件"),s("strong",[t._v("快速加载、平滑更新")]),t._v("，并在"),s("strong",[t._v("性能与电量")]),t._v("之间取得良好平衡。")])])}),[],!1,null,null,null);s.default=e.exports}}]);