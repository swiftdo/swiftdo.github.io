<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>iOS WebKit | Swift学习</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.ico">
    <script data-ad-client="ca-pub-4465026491979447" async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="WebKit框架中涉及的类很多，框架的设计十分面向对象和模块化。">
    <meta name="twitter:title" content="iOS WebKit">
    <meta name="twitter:description" content="WebKit框架中涉及的类很多，框架的设计十分面向对象和模块化。">
    <meta name="twitter:card" content="summary">
    <meta property="og:type" content="article">
    <meta property="og:title" content="iOS WebKit">
    <meta property="og:description" content="WebKit框架中涉及的类很多，框架的设计十分面向对象和模块化。">
    <meta property="article:published_time" content="2022-10-19T00:00:00.000Z">
    <meta property="article:tag" content="swift">
    <meta itemprop="name" content="iOS WebKit">
    <meta itemprop="description" content="WebKit框架中涉及的类很多，框架的设计十分面向对象和模块化。">
    <meta name="google-site-verification" content="6EogPdlAJYusvUHenXWXCGX-oVrqdeBnY-WsURHuKAA">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="keywords" content="oldbirds,oldbird,公众号,swift,swift学习,swiftui,flutter,vapor,ios,figma,数据结构,算法,书单,vuepresss,git,yaml,设计模式,编程">
    
    <link rel="preload" href="/assets/css/0.styles.21b631a1.css" as="style"><link rel="preload" href="/assets/js/app.d0a85ebb.js" as="script"><link rel="preload" href="/assets/js/3.fe443068.js" as="script"><link rel="preload" href="/assets/js/2.333abca7.js" as="script"><link rel="preload" href="/assets/js/1.09331013.js" as="script"><link rel="preload" href="/assets/js/227.e03c1caa.js" as="script"><link rel="preload" href="/assets/js/34.36196d0f.js" as="script"><link rel="prefetch" href="/assets/js/10.2a7727dc.js"><link rel="prefetch" href="/assets/js/100.564c59c3.js"><link rel="prefetch" href="/assets/js/101.cd42b276.js"><link rel="prefetch" href="/assets/js/102.30f97e0a.js"><link rel="prefetch" href="/assets/js/103.b0672a94.js"><link rel="prefetch" href="/assets/js/104.4e81e5cf.js"><link rel="prefetch" href="/assets/js/105.93e04dcf.js"><link rel="prefetch" href="/assets/js/106.d5c4f74a.js"><link rel="prefetch" href="/assets/js/107.d36bb470.js"><link rel="prefetch" href="/assets/js/108.0e8dd7e4.js"><link rel="prefetch" href="/assets/js/109.2fdfcd52.js"><link rel="prefetch" href="/assets/js/110.26e76257.js"><link rel="prefetch" href="/assets/js/111.5c69f546.js"><link rel="prefetch" href="/assets/js/112.b1c22667.js"><link rel="prefetch" href="/assets/js/113.4a6067b6.js"><link rel="prefetch" href="/assets/js/114.9f35c2c1.js"><link rel="prefetch" href="/assets/js/115.a84d922a.js"><link rel="prefetch" href="/assets/js/116.d2303523.js"><link rel="prefetch" href="/assets/js/117.18ebd88a.js"><link rel="prefetch" href="/assets/js/118.4eee8ae4.js"><link rel="prefetch" href="/assets/js/119.190120de.js"><link rel="prefetch" href="/assets/js/120.e2feb6b4.js"><link rel="prefetch" href="/assets/js/121.599526a5.js"><link rel="prefetch" href="/assets/js/122.2294872e.js"><link rel="prefetch" href="/assets/js/123.0779ad53.js"><link rel="prefetch" href="/assets/js/124.c9255088.js"><link rel="prefetch" href="/assets/js/125.19ee6b4c.js"><link rel="prefetch" href="/assets/js/126.33c4e31a.js"><link rel="prefetch" href="/assets/js/127.e4758515.js"><link rel="prefetch" href="/assets/js/128.7a7f26b0.js"><link rel="prefetch" href="/assets/js/129.1ba34240.js"><link rel="prefetch" href="/assets/js/130.07840bed.js"><link rel="prefetch" href="/assets/js/131.c0c99d80.js"><link rel="prefetch" href="/assets/js/132.9a4b3404.js"><link rel="prefetch" href="/assets/js/133.ec3f5161.js"><link rel="prefetch" href="/assets/js/134.f74adabe.js"><link rel="prefetch" href="/assets/js/135.0d3a5e3e.js"><link rel="prefetch" href="/assets/js/136.e750573c.js"><link rel="prefetch" href="/assets/js/137.b442b2e6.js"><link rel="prefetch" href="/assets/js/138.b7559c8b.js"><link rel="prefetch" href="/assets/js/139.b8426330.js"><link rel="prefetch" href="/assets/js/14.179ec236.js"><link rel="prefetch" href="/assets/js/140.c99cd7ee.js"><link rel="prefetch" href="/assets/js/141.4ec7f427.js"><link rel="prefetch" href="/assets/js/142.bd7a19e8.js"><link rel="prefetch" href="/assets/js/143.b7d5af33.js"><link rel="prefetch" href="/assets/js/144.3ae7af6a.js"><link rel="prefetch" href="/assets/js/145.042acb3e.js"><link rel="prefetch" href="/assets/js/146.3ba89254.js"><link rel="prefetch" href="/assets/js/147.37952039.js"><link rel="prefetch" href="/assets/js/148.bc91b862.js"><link rel="prefetch" href="/assets/js/149.c66fe41c.js"><link rel="prefetch" href="/assets/js/15.1892ad64.js"><link rel="prefetch" href="/assets/js/150.d42d8cdd.js"><link rel="prefetch" href="/assets/js/151.2a10eeed.js"><link rel="prefetch" href="/assets/js/152.f5c8584d.js"><link rel="prefetch" href="/assets/js/153.6b9b2809.js"><link rel="prefetch" href="/assets/js/154.630ac1ba.js"><link rel="prefetch" href="/assets/js/155.7193e723.js"><link rel="prefetch" href="/assets/js/156.dc820904.js"><link rel="prefetch" href="/assets/js/157.84a7a6c7.js"><link rel="prefetch" href="/assets/js/158.b6006cfe.js"><link rel="prefetch" href="/assets/js/159.0c25cca6.js"><link rel="prefetch" href="/assets/js/16.64bc8994.js"><link rel="prefetch" href="/assets/js/160.66cb0b06.js"><link rel="prefetch" href="/assets/js/161.7991c6f5.js"><link rel="prefetch" href="/assets/js/162.e923aa92.js"><link rel="prefetch" href="/assets/js/163.4063a420.js"><link rel="prefetch" href="/assets/js/164.38c162ea.js"><link rel="prefetch" href="/assets/js/165.7ecdd131.js"><link rel="prefetch" href="/assets/js/166.29be2edf.js"><link rel="prefetch" href="/assets/js/167.e5d61bb1.js"><link rel="prefetch" href="/assets/js/168.a27b7fb5.js"><link rel="prefetch" href="/assets/js/169.9fccac02.js"><link rel="prefetch" href="/assets/js/17.934b9510.js"><link rel="prefetch" href="/assets/js/170.9ae43d45.js"><link rel="prefetch" href="/assets/js/171.067a5a2b.js"><link rel="prefetch" href="/assets/js/172.a604af76.js"><link rel="prefetch" href="/assets/js/173.7852bf3b.js"><link rel="prefetch" href="/assets/js/174.cacdea9c.js"><link rel="prefetch" href="/assets/js/175.87128d71.js"><link rel="prefetch" href="/assets/js/176.ec4ecc2a.js"><link rel="prefetch" href="/assets/js/177.561e11eb.js"><link rel="prefetch" href="/assets/js/178.850c0754.js"><link rel="prefetch" href="/assets/js/179.b80d7abc.js"><link rel="prefetch" href="/assets/js/18.67513bdc.js"><link rel="prefetch" href="/assets/js/180.f197818c.js"><link rel="prefetch" href="/assets/js/181.a16c87f8.js"><link rel="prefetch" href="/assets/js/182.3b270249.js"><link rel="prefetch" href="/assets/js/183.439cf29a.js"><link rel="prefetch" href="/assets/js/184.df862dc1.js"><link rel="prefetch" href="/assets/js/185.d7ae9b1b.js"><link rel="prefetch" href="/assets/js/186.cd874061.js"><link rel="prefetch" href="/assets/js/187.0e8b3396.js"><link rel="prefetch" href="/assets/js/188.2d58b4c4.js"><link rel="prefetch" href="/assets/js/189.7d45fa97.js"><link rel="prefetch" href="/assets/js/19.eef0cbb0.js"><link rel="prefetch" href="/assets/js/190.3152a154.js"><link rel="prefetch" href="/assets/js/191.c0f7930f.js"><link rel="prefetch" href="/assets/js/192.f85e0129.js"><link rel="prefetch" href="/assets/js/193.a0c86328.js"><link rel="prefetch" href="/assets/js/194.207645f4.js"><link rel="prefetch" href="/assets/js/195.f464928a.js"><link rel="prefetch" href="/assets/js/196.1fb97a6f.js"><link rel="prefetch" href="/assets/js/197.1189fa97.js"><link rel="prefetch" href="/assets/js/198.7a5890f3.js"><link rel="prefetch" href="/assets/js/199.0d934016.js"><link rel="prefetch" href="/assets/js/20.c112aa3a.js"><link rel="prefetch" href="/assets/js/200.2f88a3a8.js"><link rel="prefetch" href="/assets/js/201.1e5cf7d0.js"><link rel="prefetch" href="/assets/js/202.14fd9bb5.js"><link rel="prefetch" href="/assets/js/203.5d60fea4.js"><link rel="prefetch" href="/assets/js/204.b51b095e.js"><link rel="prefetch" href="/assets/js/205.602336ca.js"><link rel="prefetch" href="/assets/js/206.bd4205d3.js"><link rel="prefetch" href="/assets/js/207.62ea0baf.js"><link rel="prefetch" href="/assets/js/208.0f2f64b3.js"><link rel="prefetch" href="/assets/js/209.ab52f322.js"><link rel="prefetch" href="/assets/js/21.048d2081.js"><link rel="prefetch" href="/assets/js/210.37433d98.js"><link rel="prefetch" href="/assets/js/211.da3b6699.js"><link rel="prefetch" href="/assets/js/212.98c8cd07.js"><link rel="prefetch" href="/assets/js/213.35d82147.js"><link rel="prefetch" href="/assets/js/214.fed86a54.js"><link rel="prefetch" href="/assets/js/215.3df759d7.js"><link rel="prefetch" href="/assets/js/216.13b405fe.js"><link rel="prefetch" href="/assets/js/217.ecabb29c.js"><link rel="prefetch" href="/assets/js/218.01ed77dc.js"><link rel="prefetch" href="/assets/js/219.5697a8fb.js"><link rel="prefetch" href="/assets/js/22.ca3ed97a.js"><link rel="prefetch" href="/assets/js/220.339ac7cf.js"><link rel="prefetch" href="/assets/js/221.f9730d9c.js"><link rel="prefetch" href="/assets/js/222.2b6f3951.js"><link rel="prefetch" href="/assets/js/223.b3c77dc5.js"><link rel="prefetch" href="/assets/js/224.bf424930.js"><link rel="prefetch" href="/assets/js/225.0112166d.js"><link rel="prefetch" href="/assets/js/226.5ca9f0eb.js"><link rel="prefetch" href="/assets/js/228.cfee724a.js"><link rel="prefetch" href="/assets/js/229.d714342c.js"><link rel="prefetch" href="/assets/js/23.a8bac1a7.js"><link rel="prefetch" href="/assets/js/230.bc9f7780.js"><link rel="prefetch" href="/assets/js/231.a6f930aa.js"><link rel="prefetch" href="/assets/js/232.3cbafc33.js"><link rel="prefetch" href="/assets/js/233.3432c77d.js"><link rel="prefetch" href="/assets/js/234.1a336069.js"><link rel="prefetch" href="/assets/js/235.0587f1bb.js"><link rel="prefetch" href="/assets/js/236.d8033058.js"><link rel="prefetch" href="/assets/js/237.8e3ce76b.js"><link rel="prefetch" href="/assets/js/238.e18d22c4.js"><link rel="prefetch" href="/assets/js/239.efb3f768.js"><link rel="prefetch" href="/assets/js/24.126ddf6d.js"><link rel="prefetch" href="/assets/js/240.06040dea.js"><link rel="prefetch" href="/assets/js/241.c9de9d5a.js"><link rel="prefetch" href="/assets/js/242.20361f1b.js"><link rel="prefetch" href="/assets/js/243.4b128449.js"><link rel="prefetch" href="/assets/js/244.9b2bdb50.js"><link rel="prefetch" href="/assets/js/245.1672bfc0.js"><link rel="prefetch" href="/assets/js/246.9ca32678.js"><link rel="prefetch" href="/assets/js/247.5b01f10a.js"><link rel="prefetch" href="/assets/js/248.209fcb36.js"><link rel="prefetch" href="/assets/js/249.dbf11f42.js"><link rel="prefetch" href="/assets/js/25.db08cc9c.js"><link rel="prefetch" href="/assets/js/250.5805543f.js"><link rel="prefetch" href="/assets/js/251.4a9e1718.js"><link rel="prefetch" href="/assets/js/252.07cce621.js"><link rel="prefetch" href="/assets/js/253.4252b3ed.js"><link rel="prefetch" href="/assets/js/254.15206530.js"><link rel="prefetch" href="/assets/js/255.2e24e80a.js"><link rel="prefetch" href="/assets/js/256.afbee763.js"><link rel="prefetch" href="/assets/js/257.57508753.js"><link rel="prefetch" href="/assets/js/258.f3b2763e.js"><link rel="prefetch" href="/assets/js/259.519b00c9.js"><link rel="prefetch" href="/assets/js/26.9e001bfc.js"><link rel="prefetch" href="/assets/js/260.2ee3a202.js"><link rel="prefetch" href="/assets/js/261.976bd2df.js"><link rel="prefetch" href="/assets/js/262.a7545678.js"><link rel="prefetch" href="/assets/js/263.9e646f3d.js"><link rel="prefetch" href="/assets/js/264.7abd8aa7.js"><link rel="prefetch" href="/assets/js/265.09a017a2.js"><link rel="prefetch" href="/assets/js/266.142bf96e.js"><link rel="prefetch" href="/assets/js/267.8f6edcff.js"><link rel="prefetch" href="/assets/js/268.360fc820.js"><link rel="prefetch" href="/assets/js/269.3df9e6c6.js"><link rel="prefetch" href="/assets/js/27.8616dfea.js"><link rel="prefetch" href="/assets/js/270.f2378f01.js"><link rel="prefetch" href="/assets/js/271.78a074af.js"><link rel="prefetch" href="/assets/js/272.633743c4.js"><link rel="prefetch" href="/assets/js/273.5b0f5c93.js"><link rel="prefetch" href="/assets/js/274.7c956dbc.js"><link rel="prefetch" href="/assets/js/275.7d3662fe.js"><link rel="prefetch" href="/assets/js/276.5df3ead4.js"><link rel="prefetch" href="/assets/js/277.cf7ab375.js"><link rel="prefetch" href="/assets/js/278.b52689ff.js"><link rel="prefetch" href="/assets/js/279.7eeb9ddd.js"><link rel="prefetch" href="/assets/js/28.7f9106d6.js"><link rel="prefetch" href="/assets/js/280.9a715797.js"><link rel="prefetch" href="/assets/js/281.bafc37a1.js"><link rel="prefetch" href="/assets/js/282.58c651ad.js"><link rel="prefetch" href="/assets/js/283.88adb71e.js"><link rel="prefetch" href="/assets/js/284.6dcee1aa.js"><link rel="prefetch" href="/assets/js/285.1fe7e51a.js"><link rel="prefetch" href="/assets/js/286.1aa89ea9.js"><link rel="prefetch" href="/assets/js/287.6099629c.js"><link rel="prefetch" href="/assets/js/288.effe69cb.js"><link rel="prefetch" href="/assets/js/289.deec252e.js"><link rel="prefetch" href="/assets/js/29.a622c1c4.js"><link rel="prefetch" href="/assets/js/290.2c38f23c.js"><link rel="prefetch" href="/assets/js/291.1a3f113b.js"><link rel="prefetch" href="/assets/js/292.f3671dc1.js"><link rel="prefetch" href="/assets/js/293.498e6bc6.js"><link rel="prefetch" href="/assets/js/294.e8782159.js"><link rel="prefetch" href="/assets/js/295.5d79e78e.js"><link rel="prefetch" href="/assets/js/296.8bc17dc6.js"><link rel="prefetch" href="/assets/js/297.447b3d30.js"><link rel="prefetch" href="/assets/js/298.8e44b048.js"><link rel="prefetch" href="/assets/js/299.ca8df1fb.js"><link rel="prefetch" href="/assets/js/30.6c4d25d5.js"><link rel="prefetch" href="/assets/js/300.e3083f89.js"><link rel="prefetch" href="/assets/js/301.7f863f25.js"><link rel="prefetch" href="/assets/js/302.71fc4236.js"><link rel="prefetch" href="/assets/js/303.38c33421.js"><link rel="prefetch" href="/assets/js/304.72621f35.js"><link rel="prefetch" href="/assets/js/305.f65bac33.js"><link rel="prefetch" href="/assets/js/306.a190e3ec.js"><link rel="prefetch" href="/assets/js/307.63e5b70c.js"><link rel="prefetch" href="/assets/js/308.1db87474.js"><link rel="prefetch" href="/assets/js/309.868ddc34.js"><link rel="prefetch" href="/assets/js/31.3f271932.js"><link rel="prefetch" href="/assets/js/310.a13fcc9c.js"><link rel="prefetch" href="/assets/js/311.336e049b.js"><link rel="prefetch" href="/assets/js/312.83eae229.js"><link rel="prefetch" href="/assets/js/313.7dc83db5.js"><link rel="prefetch" href="/assets/js/314.aea48bc8.js"><link rel="prefetch" href="/assets/js/315.dee31022.js"><link rel="prefetch" href="/assets/js/316.6f9e65d3.js"><link rel="prefetch" href="/assets/js/317.c14640db.js"><link rel="prefetch" href="/assets/js/318.5c472876.js"><link rel="prefetch" href="/assets/js/319.a8219cee.js"><link rel="prefetch" href="/assets/js/32.e8a00280.js"><link rel="prefetch" href="/assets/js/320.402baa65.js"><link rel="prefetch" href="/assets/js/321.32fe2e0e.js"><link rel="prefetch" href="/assets/js/322.9f739bca.js"><link rel="prefetch" href="/assets/js/323.bdc40a24.js"><link rel="prefetch" href="/assets/js/324.cf85df3c.js"><link rel="prefetch" href="/assets/js/325.54fd9f26.js"><link rel="prefetch" href="/assets/js/326.e9444749.js"><link rel="prefetch" href="/assets/js/327.45ae59ee.js"><link rel="prefetch" href="/assets/js/328.448c1f82.js"><link rel="prefetch" href="/assets/js/329.abd8947a.js"><link rel="prefetch" href="/assets/js/33.df11a54e.js"><link rel="prefetch" href="/assets/js/330.0a8b8511.js"><link rel="prefetch" href="/assets/js/331.0537f001.js"><link rel="prefetch" href="/assets/js/332.1534f1a1.js"><link rel="prefetch" href="/assets/js/333.33b0257a.js"><link rel="prefetch" href="/assets/js/334.b59ec7cc.js"><link rel="prefetch" href="/assets/js/335.6459aca3.js"><link rel="prefetch" href="/assets/js/336.fdb787cf.js"><link rel="prefetch" href="/assets/js/337.c5dd101e.js"><link rel="prefetch" href="/assets/js/338.ea2a5fba.js"><link rel="prefetch" href="/assets/js/339.ea0aaaf5.js"><link rel="prefetch" href="/assets/js/340.829038fb.js"><link rel="prefetch" href="/assets/js/341.c6ba2d72.js"><link rel="prefetch" href="/assets/js/342.ca9bf68a.js"><link rel="prefetch" href="/assets/js/343.0b4b37e9.js"><link rel="prefetch" href="/assets/js/344.6831d6d4.js"><link rel="prefetch" href="/assets/js/345.6d93d504.js"><link rel="prefetch" href="/assets/js/346.246a7ca0.js"><link rel="prefetch" href="/assets/js/347.13a745af.js"><link rel="prefetch" href="/assets/js/348.b078f361.js"><link rel="prefetch" href="/assets/js/349.2a0d20be.js"><link rel="prefetch" href="/assets/js/35.6bed82d1.js"><link rel="prefetch" href="/assets/js/350.c98299d0.js"><link rel="prefetch" href="/assets/js/351.37acb01f.js"><link rel="prefetch" href="/assets/js/352.5e4ff587.js"><link rel="prefetch" href="/assets/js/353.12481e37.js"><link rel="prefetch" href="/assets/js/354.ba66774a.js"><link rel="prefetch" href="/assets/js/355.f2e45053.js"><link rel="prefetch" href="/assets/js/356.5e40d24a.js"><link rel="prefetch" href="/assets/js/357.675e6cab.js"><link rel="prefetch" href="/assets/js/358.aa51915d.js"><link rel="prefetch" href="/assets/js/359.e3fe7f4c.js"><link rel="prefetch" href="/assets/js/36.3277f5f0.js"><link rel="prefetch" href="/assets/js/360.7a7e538f.js"><link rel="prefetch" href="/assets/js/37.cce44f1d.js"><link rel="prefetch" href="/assets/js/38.0e7e17c8.js"><link rel="prefetch" href="/assets/js/39.d98ef824.js"><link rel="prefetch" href="/assets/js/4.26becfc9.js"><link rel="prefetch" href="/assets/js/40.4600d658.js"><link rel="prefetch" href="/assets/js/41.fce8a83a.js"><link rel="prefetch" href="/assets/js/42.5da2c8bf.js"><link rel="prefetch" href="/assets/js/43.533c2b80.js"><link rel="prefetch" href="/assets/js/44.0b5e9d9b.js"><link rel="prefetch" href="/assets/js/45.35c56329.js"><link rel="prefetch" href="/assets/js/46.71ab8ae8.js"><link rel="prefetch" href="/assets/js/47.2ede5b0e.js"><link rel="prefetch" href="/assets/js/48.ea767660.js"><link rel="prefetch" href="/assets/js/49.edb9a824.js"><link rel="prefetch" href="/assets/js/5.da4c3ffc.js"><link rel="prefetch" href="/assets/js/50.c41917c9.js"><link rel="prefetch" href="/assets/js/51.746966f9.js"><link rel="prefetch" href="/assets/js/52.c79f5015.js"><link rel="prefetch" href="/assets/js/53.318a822f.js"><link rel="prefetch" href="/assets/js/54.beeadceb.js"><link rel="prefetch" href="/assets/js/55.d2c56783.js"><link rel="prefetch" href="/assets/js/56.ae1e02f3.js"><link rel="prefetch" href="/assets/js/57.b6507420.js"><link rel="prefetch" href="/assets/js/58.91f066d0.js"><link rel="prefetch" href="/assets/js/59.aa0db3b2.js"><link rel="prefetch" href="/assets/js/6.1d628d80.js"><link rel="prefetch" href="/assets/js/60.87e22cf8.js"><link rel="prefetch" href="/assets/js/61.1823a789.js"><link rel="prefetch" href="/assets/js/62.0e34c0be.js"><link rel="prefetch" href="/assets/js/63.faea59bf.js"><link rel="prefetch" href="/assets/js/64.ca313b96.js"><link rel="prefetch" href="/assets/js/65.8ab5bfe4.js"><link rel="prefetch" href="/assets/js/66.37fcbb42.js"><link rel="prefetch" href="/assets/js/67.063d0beb.js"><link rel="prefetch" href="/assets/js/68.8d7373b2.js"><link rel="prefetch" href="/assets/js/69.dcb922f9.js"><link rel="prefetch" href="/assets/js/7.82612638.js"><link rel="prefetch" href="/assets/js/70.f1db9000.js"><link rel="prefetch" href="/assets/js/71.00e71fba.js"><link rel="prefetch" href="/assets/js/72.8e802c88.js"><link rel="prefetch" href="/assets/js/73.d6177d1e.js"><link rel="prefetch" href="/assets/js/74.e6612549.js"><link rel="prefetch" href="/assets/js/75.5f5e9e6d.js"><link rel="prefetch" href="/assets/js/76.0abdf9c6.js"><link rel="prefetch" href="/assets/js/77.53e016ee.js"><link rel="prefetch" href="/assets/js/78.92540989.js"><link rel="prefetch" href="/assets/js/79.f43a5f97.js"><link rel="prefetch" href="/assets/js/8.0d3f5ec9.js"><link rel="prefetch" href="/assets/js/80.bd5a42d0.js"><link rel="prefetch" href="/assets/js/81.e0f40422.js"><link rel="prefetch" href="/assets/js/82.a3660e5c.js"><link rel="prefetch" href="/assets/js/83.081a9f62.js"><link rel="prefetch" href="/assets/js/84.abbc5b1c.js"><link rel="prefetch" href="/assets/js/85.6019c25d.js"><link rel="prefetch" href="/assets/js/86.6290b650.js"><link rel="prefetch" href="/assets/js/87.44ee4eaa.js"><link rel="prefetch" href="/assets/js/88.37a5f600.js"><link rel="prefetch" href="/assets/js/89.b75ae169.js"><link rel="prefetch" href="/assets/js/9.0f286391.js"><link rel="prefetch" href="/assets/js/90.afddd590.js"><link rel="prefetch" href="/assets/js/91.e86643e9.js"><link rel="prefetch" href="/assets/js/92.2d7de507.js"><link rel="prefetch" href="/assets/js/93.484376f0.js"><link rel="prefetch" href="/assets/js/94.928b5551.js"><link rel="prefetch" href="/assets/js/95.77f88340.js"><link rel="prefetch" href="/assets/js/96.1b771706.js"><link rel="prefetch" href="/assets/js/97.9caafadb.js"><link rel="prefetch" href="/assets/js/98.bea25e41.js"><link rel="prefetch" href="/assets/js/99.153d04fb.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.e3370f81.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.e9113b49.js">
    <link rel="stylesheet" href="/assets/css/0.styles.21b631a1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Swift学习</h3> <p class="description" data-v-59e6cb88>过来人的笔记，带你最佳实践，@OldBirds公众号</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>oldbirds</span>
          
        <span data-v-59e6cb88>2020 - </span>
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Swift学习" class="logo"> <span class="site-name">Swift学习</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Swift
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/swift/swiftui/" class="nav-link"><i class="undefined"></i>
  SwiftUI
</a></li><li class="dropdown-item"><!----> <a href="/swift/ubuntu/" class="nav-link"><i class="undefined"></i>
  Ubuntu中Swift开发
</a></li><li class="dropdown-item"><!----> <a href="/swift/vapor/" class="nav-link"><i class="undefined"></i>
  Vapor
</a></li><li class="dropdown-item"><!----> <a href="/swift/ios/" class="nav-link router-link-active"><i class="undefined"></i>
  iOS
</a></li><li class="dropdown-item"><!----> <a href="/swift/tips/" class="nav-link"><i class="undefined"></i>
  Tips
</a></li><li class="dropdown-item"><!----> <a href="/swift/fp/" class="nav-link"><i class="undefined"></i>
  函数式编程
</a></li><li class="dropdown-item"><!----> <a href="/swift/better/" class="nav-link"><i class="undefined"></i>
  写更好的Swift代码系列
</a></li><li class="dropdown-item"><!----> <a href="/swift/spm/" class="nav-link"><i class="undefined"></i>
  Swift Package Manage
</a></li></ul></div></div><div class="nav-item"><a href="/flutter/" class="nav-link"><i class="undefined"></i>
  Flutter
</a></div><div class="nav-item"><a href="/python/" class="nav-link"><i class="undefined"></i>
  Python
</a></div><div class="nav-item"><a href="/vue/" class="nav-link"><i class="undefined"></i>
  Vue
</a></div><div class="nav-item"><a href="/java/" class="nav-link"><i class="undefined"></i>
  Java
</a></div><div class="nav-item"><a href="/design-patterns/" class="nav-link"><i class="undefined"></i>
  设计模式
</a></div><div class="nav-item"><a href="https://oldbird.run/algorithms" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  数据结构与算法
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://oldbird.run/books/#/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  书单
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      其他
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/basis/index/" class="nav-link"><i class="undefined"></i>
  概要
</a></li><li class="dropdown-subitem"><a href="/basis/os/" class="nav-link"><i class="undefined"></i>
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/git/" class="nav-link"><i class="undefined"></i>
  Git
</a></li><li class="dropdown-subitem"><a href="/tools/yaml/" class="nav-link"><i class="undefined"></i>
  YAML
</a></li><li class="dropdown-subitem"><a href="/tools/html/" class="nav-link"><i class="undefined"></i>
  HTML
</a></li><li class="dropdown-subitem"><a href="/tools/plantuml/" class="nav-link"><i class="undefined"></i>
  PlantUML
</a></li><li class="dropdown-subitem"><a href="/tools/flowchart/" class="nav-link"><i class="undefined"></i>
  流程图 Flowchart
</a></li><li class="dropdown-subitem"><a href="/ai/" class="nav-link"><i class="undefined"></i>
  AI
</a></li><li class="dropdown-subitem"><a href="/figma/" class="nav-link"><i class="undefined"></i>
  Figma
</a></li><li class="dropdown-subitem"><a href="/tools/docsify.html" class="nav-link"><i class="undefined"></i>
  docsify
</a></li><li class="dropdown-subitem"><a href="/tools/vuepress/" class="nav-link"><i class="undefined"></i>
  VuePress
</a></li><li class="dropdown-subitem"><a href="/tools/note/" class="nav-link"><i class="undefined"></i>
  Note
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/haskell/" class="nav-link"><i class="undefined"></i>
  Haskell
</a></li><li class="dropdown-item"><h4>C&amp;C++</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/c/program/" class="nav-link"><i class="undefined"></i>
  语言篇
</a></li><li class="dropdown-subitem"><a href="/c/audio/" class="nav-link"><i class="undefined"></i>
  音频篇
</a></li><li class="dropdown-subitem"><a href="/c/cmake/" class="nav-link"><i class="undefined"></i>
  CMake篇
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/index/" class="nav-link"><i class="undefined"></i>
  关于我们
</a></li></ul></div></div> <a href="https://github.com/swiftdo/swiftdo.github.io" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/logo.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    oldbirds
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>306</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>45</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Swift
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/swift/swiftui/" class="nav-link"><i class="undefined"></i>
  SwiftUI
</a></li><li class="dropdown-item"><!----> <a href="/swift/ubuntu/" class="nav-link"><i class="undefined"></i>
  Ubuntu中Swift开发
</a></li><li class="dropdown-item"><!----> <a href="/swift/vapor/" class="nav-link"><i class="undefined"></i>
  Vapor
</a></li><li class="dropdown-item"><!----> <a href="/swift/ios/" class="nav-link router-link-active"><i class="undefined"></i>
  iOS
</a></li><li class="dropdown-item"><!----> <a href="/swift/tips/" class="nav-link"><i class="undefined"></i>
  Tips
</a></li><li class="dropdown-item"><!----> <a href="/swift/fp/" class="nav-link"><i class="undefined"></i>
  函数式编程
</a></li><li class="dropdown-item"><!----> <a href="/swift/better/" class="nav-link"><i class="undefined"></i>
  写更好的Swift代码系列
</a></li><li class="dropdown-item"><!----> <a href="/swift/spm/" class="nav-link"><i class="undefined"></i>
  Swift Package Manage
</a></li></ul></div></div><div class="nav-item"><a href="/flutter/" class="nav-link"><i class="undefined"></i>
  Flutter
</a></div><div class="nav-item"><a href="/python/" class="nav-link"><i class="undefined"></i>
  Python
</a></div><div class="nav-item"><a href="/vue/" class="nav-link"><i class="undefined"></i>
  Vue
</a></div><div class="nav-item"><a href="/java/" class="nav-link"><i class="undefined"></i>
  Java
</a></div><div class="nav-item"><a href="/design-patterns/" class="nav-link"><i class="undefined"></i>
  设计模式
</a></div><div class="nav-item"><a href="https://oldbird.run/algorithms" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  数据结构与算法
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://oldbird.run/books/#/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  书单
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      其他
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/basis/index/" class="nav-link"><i class="undefined"></i>
  概要
</a></li><li class="dropdown-subitem"><a href="/basis/os/" class="nav-link"><i class="undefined"></i>
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/git/" class="nav-link"><i class="undefined"></i>
  Git
</a></li><li class="dropdown-subitem"><a href="/tools/yaml/" class="nav-link"><i class="undefined"></i>
  YAML
</a></li><li class="dropdown-subitem"><a href="/tools/html/" class="nav-link"><i class="undefined"></i>
  HTML
</a></li><li class="dropdown-subitem"><a href="/tools/plantuml/" class="nav-link"><i class="undefined"></i>
  PlantUML
</a></li><li class="dropdown-subitem"><a href="/tools/flowchart/" class="nav-link"><i class="undefined"></i>
  流程图 Flowchart
</a></li><li class="dropdown-subitem"><a href="/ai/" class="nav-link"><i class="undefined"></i>
  AI
</a></li><li class="dropdown-subitem"><a href="/figma/" class="nav-link"><i class="undefined"></i>
  Figma
</a></li><li class="dropdown-subitem"><a href="/tools/docsify.html" class="nav-link"><i class="undefined"></i>
  docsify
</a></li><li class="dropdown-subitem"><a href="/tools/vuepress/" class="nav-link"><i class="undefined"></i>
  VuePress
</a></li><li class="dropdown-subitem"><a href="/tools/note/" class="nav-link"><i class="undefined"></i>
  Note
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/haskell/" class="nav-link"><i class="undefined"></i>
  Haskell
</a></li><li class="dropdown-item"><h4>C&amp;C++</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/c/program/" class="nav-link"><i class="undefined"></i>
  语言篇
</a></li><li class="dropdown-subitem"><a href="/c/audio/" class="nav-link"><i class="undefined"></i>
  音频篇
</a></li><li class="dropdown-subitem"><a href="/c/cmake/" class="nav-link"><i class="undefined"></i>
  CMake篇
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/index/" class="nav-link"><i class="undefined"></i>
  关于我们
</a></li></ul></div></div> <a href="https://github.com/swiftdo/swiftdo.github.io" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>iOS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/swift/ios/" aria-current="page" class="sidebar-link">开始</a></li><li><a href="/swift/ios/t1-pod-webp.html" class="sidebar-link">Pod libwebp 安装失败</a></li><li><a href="/swift/ios/t2-youhua.html" class="sidebar-link">iOS 优化角度</a></li><li><a href="/swift/ios/pod-wechat.html" class="sidebar-link">5分钟创建 WechatOpenSDK 1.9.2 版本的pod库</a></li><li><a href="/swift/ios/ios-build-cers.html" class="sidebar-link">iOS 打包证书制作</a></li><li><a href="/swift/ios/XCFramework.html" class="sidebar-link">XCFramework</a></li><li><a href="/swift/ios/ios-webkit.html" aria-current="page" class="active sidebar-link">iOS WebKit</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>iOS WebKit</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>oldbirds</span>
          
        <span data-v-59e6cb88>2020 - </span>
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">iOS WebKit</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>oldbirds</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>10/19/2022</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>swift</span><span class="tag-item" data-v-8a445198>ios</span><span class="tag-item" data-v-8a445198>webkit</span></i></div></div> <div class="theme-reco-content content__default"><p>WebKit框架中涉及的类很多，框架的设计十分面向对象和模块化。</p> <p>WebKit 框架中最核心的类应该属于 WKWebView了，这个类专门用来渲染网页视图，其他类和协议都将基于它和服务于它。</p> <ul><li>WKWebView：网页的渲染与展示，通过WKWebViewConfiguration可以进行配置。</li> <li>WKWebViewConfiguration：这个类专门用来配置WKWebView。</li> <li>WKPreference:这个类用来进行M相关设置。</li> <li>WKProcessPool：这个类用来配置进程池，与网页视图的资源共享有关。</li> <li>WKUserContentController：这个类主要用来做native与JavaScript的交互管理。</li> <li>WKUserScript：用于进行JavaScript注入。</li> <li>WKScriptMessageHandler：这个类专门用来处理JavaScript调用native的方法。</li> <li>WKNavigationDelegate：网页跳转间的导航管理协议，这个协议可以监听网页的活动。</li> <li>WKNavigationAction：网页某个活动的示例化对象。</li> <li>WKUIDelegate：用于交互处理JavaScript中的一些弹出框。</li> <li>WKBackForwardList：堆栈管理的网页列表。</li> <li>WKBackForwardListItem：每个网页节点对象。</li></ul> <h2 id="快速使用"><a href="#快速使用" class="header-anchor">#</a> 快速使用</h2> <p>使用 WKWebViewConfiguration 对 WebView 进行配置。</p> <p>使用下面的代码可以创建一个 WKWebView 视图，创建 WebView 视图时，需要使用WKWebViewConfiguration 来进行配置：</p> <div class="language-objc extra-class"><pre class="language-objc"><code>WKWebView <span class="token operator">*</span> WK<span class="token punctuation">;</span>
WKWebViewConfiguration <span class="token operator">*</span> config <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>WKWebViewConfiguration alloc<span class="token punctuation">]</span>init<span class="token punctuation">]</span><span class="token punctuation">;</span>
WK <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>WKWebView alloc<span class="token punctuation">]</span>initWithFrame<span class="token punctuation">:</span><span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">)</span> configuration<span class="token punctuation">:</span>config<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>WK loadRequest<span class="token punctuation">:</span><span class="token punctuation">[</span>NSURLRequest requestWithURL<span class="token punctuation">:</span><span class="token punctuation">[</span>NSURL URLWithString<span class="token punctuation">:</span><span class="token string">@&quot;http://www.baidu.com&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>设置进程池</strong></p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//设置进程池</span>
WKProcessPool <span class="token operator">*</span> pool <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>WKProcessPool alloc<span class="token punctuation">]</span>init<span class="token punctuation">]</span><span class="token punctuation">;</span>
config<span class="token punctuation">.</span>processPool <span class="token operator">=</span> pool<span class="token punctuation">;</span>
</code></pre></div><p>WKProcessPool 类中没有暴露任何属性和方法，配置为同一个进程池的 WebView 会共享数据，例如 Cookie、用户凭证等，开发者可以通过编写管理类来分配不同维度的 WebView 在不同进程池中。</p> <p><strong>进行偏好设置</strong></p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//进行偏好设置</span>
WKPreferences <span class="token operator">*</span> preference <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>WKPreferences alloc<span class="token punctuation">]</span>init<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//最小字体大小 当将javaScriptEnabled属性设置为NO时，可以看到明显的效果</span>
preference<span class="token punctuation">.</span>minimumFontSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//设置是否支持 javaScript 默认是支持的</span>
preference<span class="token punctuation">.</span>javaScriptEnabled <span class="token operator">=</span> YES<span class="token punctuation">;</span>

<span class="token comment">//设置是否允许不经过用户交互由javaScript自动打开窗口</span>
preference<span class="token punctuation">.</span>javaScriptCanOpenWindowsAutomatically <span class="token operator">=</span> YES<span class="token punctuation">;</span>
config<span class="token punctuation">.</span>preferences <span class="token operator">=</span> preference<span class="token punctuation">;</span>
</code></pre></div><p>WKPerference实例为WebView提供一个偏好设置。</p> <p><strong>管理native与JavaScript的交互行为</strong></p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//设置内容交互控制器 用于处理JavaScript与native交互</span>
WKUserContentController <span class="token operator">*</span>userController <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>WKUserContentController alloc<span class="token punctuation">]</span>init<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//设置处理代理并且注册要被js调用的方法名称</span>
<span class="token punctuation">[</span>userController addScriptMessageHandler<span class="token punctuation">:</span><span class="token keyword">self</span> name<span class="token punctuation">:</span><span class="token string">@&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//js注入，注入一个测试方法。</span>
NSString <span class="token operator">*</span>javaScriptSource <span class="token operator">=</span> <span class="token string">@&quot;function userFunc(){window.webkit.messageHandlers.name.postMessage( {\&quot;name\&quot;:\&quot;HS\&quot;})}&quot;</span><span class="token punctuation">;</span>
WKUserScript <span class="token operator">*</span>userScript <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>WKUserScript alloc<span class="token punctuation">]</span> initWithSource<span class="token punctuation">:</span>javaScriptSource injectionTime<span class="token punctuation">:</span>WKUserScriptInjectionTimeAtDocumentStart forMainFrameOnly<span class="token punctuation">:</span>YES<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// forMainFrameOnly:NO(全局窗口)，yes（只限主窗口）</span>
<span class="token punctuation">[</span>userController addUserScript<span class="token punctuation">:</span>userScript<span class="token punctuation">]</span><span class="token punctuation">;</span>
config<span class="token punctuation">.</span>userContentController <span class="token operator">=</span> userController<span class="token punctuation">;</span>
</code></pre></div><p>WKUserContentController 专门用来管理 native 与 JavaScript 的交互行为，<code>addScriptMessageHandler:name:</code>方法来注册要被 js 调用的方法名称，之后再 JavaScript 中使用<code>window.webkit.messageHandlers.name.postMessage()</code>方法来像 native 发送消息，支持 OC 中字典，数组，NSNumber 等原生数据类型，JavaScript 代码中的 name 要和上面注册的相同。在 native 代理的回调方法中，会获取到 JavaScript 传递进来的消息，如下：</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>userContentController<span class="token punctuation">:</span><span class="token punctuation">(</span>WKUserContentController <span class="token operator">*</span><span class="token punctuation">)</span>userContentController didReceiveScriptMessage<span class="token punctuation">:</span><span class="token punctuation">(</span>WKScriptMessage <span class="token operator">*</span><span class="token punctuation">)</span>message<span class="token punctuation">{</span>
    <span class="token comment">//这里可以获取到JavaScript传递进来的消息</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>WKScriptMessage</code>类是 JavaScript 传递的对象实例，其中属性如下：</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//传递的消息主体</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> id body<span class="token punctuation">;</span>
<span class="token comment">//传递消息的WebView</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> weak<span class="token punctuation">)</span> WKWebView <span class="token operator">*</span>webView<span class="token punctuation">;</span>
<span class="token comment">//传递消息的WebView当前页面对象</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> WKFrameInfo <span class="token operator">*</span>frameInfo<span class="token punctuation">;</span>
<span class="token comment">//消息名称</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSString <span class="token operator">*</span>name<span class="token punctuation">;</span>
</code></pre></div><p>WKUserContentController 实例的<code>addUserScript:</code>用于注入JavaScript代码。</p> <p><strong>缓存框架</strong></p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">// 设置数据存储store</span>
config<span class="token punctuation">.</span>websiteDataStore <span class="token operator">=</span> <span class="token punctuation">[</span>WKWebsiteDataStore defaultDataStore<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>WebKit 框架采用其本身的缓存框架，WKWebsiteDataStore 类用来处理数据的存储，其中属性和方法如下：</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token keyword">@interface</span> WKWebsiteDataStore <span class="token punctuation">:</span> NSObject
<span class="token comment">// 获取默认的存储器 此存储器为持久性的会被写入磁盘</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>WKWebsiteDataStore <span class="token operator">*</span><span class="token punctuation">)</span>defaultDataStore<span class="token punctuation">;</span>
<span class="token comment">// 获取一个临时的存储器</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>WKWebsiteDataStore <span class="token operator">*</span><span class="token punctuation">)</span>nonPersistentDataStore<span class="token punctuation">;</span>
<span class="token comment">// 存储器是否是临时的</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> getter<span class="token operator">=</span>isPersistent<span class="token punctuation">)</span> BOOL persistent<span class="token punctuation">;</span>
<span class="token comment">// 所有可以存储的类型</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>NSSet<span class="token operator">&lt;</span>NSString <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span><span class="token punctuation">)</span>allWebsiteDataTypes<span class="token punctuation">;</span>
<span class="token keyword">@end</span>
</code></pre></div><p><strong>其他属性</strong></p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">// 设置是否将网页内容全部加载到内存后再渲染</span>
config<span class="token punctuation">.</span>suppressesIncrementalRendering <span class="token operator">=</span> NO<span class="token punctuation">;</span>
<span class="token comment">// 设置 HTML5 视频是否允许网页播放，设置为NO则会使用本地播放器</span>
config<span class="token punctuation">.</span>allowsInlineMediaPlayback <span class="token operator">=</span>  YES<span class="token punctuation">;</span>
<span class="token comment">// 设置是否允许ariPlay播放</span>
config<span class="token punctuation">.</span>allowsAirPlayForMediaPlayback <span class="token operator">=</span> YES<span class="token punctuation">;</span>
<span class="token comment">// 设置视频是否需要用户手动播放  设置为NO则会允许自动播放</span>
config<span class="token punctuation">.</span>requiresUserActionForMediaPlayback <span class="token operator">=</span> NO<span class="token punctuation">;</span>
<span class="token comment">// 设置是否允许画中画技术 在特定设备上有效</span>
config<span class="token punctuation">.</span>allowsPictureInPictureMediaPlayback <span class="token operator">=</span> YES<span class="token punctuation">;</span>
<span class="token comment">// 设置选择模式 是按字符选择 还是按模块选择</span>
<span class="token comment">/*
typedef NS_ENUM(NSInteger, WKSelectionGranularity) {
    //按模块选择
    WKSelectionGranularityDynamic,
    //按字符选择
    WKSelectionGranularityCharacter,
} NS_ENUM_AVAILABLE_IOS(8_0);
*/</span>
config<span class="token punctuation">.</span>selectionGranularity <span class="token operator">=</span> WKSelectionGranularityCharacter<span class="token punctuation">;</span>

<span class="token comment">//设置请求的User-Agent信息中应用程序名称 iOS9后可用</span>
config<span class="token punctuation">.</span>applicationNameForUserAgent <span class="token operator">=</span> <span class="token string">@&quot;HS&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="wkwebview-中的属性和方法解析"><a href="#wkwebview-中的属性和方法解析" class="header-anchor">#</a> WKWebView 中的属性和方法解析</h2> <p>下面列举了WKWebView中常用的属性和方法。</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//设置导航代理</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> weak<span class="token punctuation">)</span> id <span class="token operator">&lt;</span>WKNavigationDelegate<span class="token operator">&gt;</span> navigationDelegate<span class="token punctuation">;</span>
<span class="token comment">//设置UI代理</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> weak<span class="token punctuation">)</span> id <span class="token operator">&lt;</span>WKUIDelegate<span class="token operator">&gt;</span> UIDelegate<span class="token punctuation">;</span>
<span class="token comment">//导航列表</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> WKBackForwardList <span class="token operator">*</span>backForwardList<span class="token punctuation">;</span>
<span class="token comment">//通过url加载网页视图</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>loadRequest<span class="token punctuation">:</span><span class="token punctuation">(</span>NSURLRequest <span class="token operator">*</span><span class="token punctuation">)</span>request<span class="token punctuation">;</span>
<span class="token comment">//通过文件加载网页视图</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>loadFileURL<span class="token punctuation">:</span><span class="token punctuation">(</span>NSURL <span class="token operator">*</span><span class="token punctuation">)</span>URL allowingReadAccessToURL<span class="token punctuation">:</span><span class="token punctuation">(</span>NSURL <span class="token operator">*</span><span class="token punctuation">)</span>readAccessURL <span class="token function">NS_AVAILABLE</span><span class="token punctuation">(</span><span class="token number">10</span>_11<span class="token punctuation">,</span> <span class="token number">9</span>_0<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过HTML字符串加载网页视图</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>loadHTMLString<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>string baseURL<span class="token punctuation">:</span><span class="token punctuation">(</span>nullable NSURL <span class="token operator">*</span><span class="token punctuation">)</span>baseURL<span class="token punctuation">;</span>
<span class="token comment">//通过data数据加载网页视图</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>loadData<span class="token punctuation">:</span><span class="token punctuation">(</span>NSData <span class="token operator">*</span><span class="token punctuation">)</span>data MIMEType<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>MIMEType characterEncodingName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>characterEncodingName baseURL<span class="token punctuation">:</span><span class="token punctuation">(</span>NSURL <span class="token operator">*</span><span class="token punctuation">)</span>baseURL <span class="token function">NS_AVAILABLE</span><span class="token punctuation">(</span><span class="token number">10</span>_11<span class="token punctuation">,</span> <span class="token number">9</span>_0<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//渲染导航列表中的某个网页节点</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>goToBackForwardListItem<span class="token punctuation">:</span><span class="token punctuation">(</span>WKBackForwardListItem <span class="token operator">*</span><span class="token punctuation">)</span>item<span class="token punctuation">;</span>
<span class="token comment">//网页标题</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSString <span class="token operator">*</span>title<span class="token punctuation">;</span>
<span class="token comment">//网页的url</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSURL <span class="token operator">*</span>URL<span class="token punctuation">;</span>
<span class="token comment">//网页是否正在加载中</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> getter<span class="token operator">=</span>isLoading<span class="token punctuation">)</span> BOOL loading<span class="token punctuation">;</span>
<span class="token comment">//加载进度 可以监听这个属性的值配合UIProgressView来设计进度条</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">)</span> <span class="token keyword">double</span> estimatedProgress<span class="token punctuation">;</span>
<span class="token comment">//是否全部是安全连接</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">)</span> BOOL hasOnlySecureContent<span class="token punctuation">;</span>
<span class="token comment">//证书列表</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSArray <span class="token operator">*</span>certificateChain<span class="token punctuation">;</span>
<span class="token comment">//是否可以回退</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">)</span> BOOL canGoBack<span class="token punctuation">;</span>
<span class="token comment">//是否可以前进</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">)</span> BOOL canGoForward<span class="token punctuation">;</span>
<span class="token comment">//回退网页</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>goBack<span class="token punctuation">;</span>
<span class="token comment">//前进网页</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>goForward<span class="token punctuation">;</span>
<span class="token comment">//刷新网页</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>reload<span class="token punctuation">;</span>
<span class="token comment">//忽略缓存的刷新</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>reloadFromOrigin<span class="token punctuation">;</span>
<span class="token comment">//停止加载</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>stopLoading<span class="token punctuation">;</span>
<span class="token comment">//执行JavaScript代码</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>evaluateJavaScript<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>javaScriptString completionHandler<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span> __nullable<span class="token punctuation">)</span><span class="token punctuation">(</span>__nullable id<span class="token punctuation">,</span> NSError <span class="token operator">*</span> __nullable error<span class="token punctuation">)</span><span class="token punctuation">)</span>completionHandler<span class="token punctuation">;</span>
<span class="token comment">//是否允许右滑返回手势</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">)</span> BOOL allowsBackForwardNavigationGestures<span class="token punctuation">;</span>
</code></pre></div><p><strong>WKBackForwardList</strong></p> <p>WKBackForwardList 类为导航管理的网页列表类</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token keyword">@interface</span> WKBackForwardList <span class="token punctuation">:</span> NSObject
<span class="token comment">//当前所在的网页节点</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> WKBackForwardListItem <span class="token operator">*</span>currentItem<span class="token punctuation">;</span>
<span class="token comment">//前进的一个网页节点</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> WKBackForwardListItem <span class="token operator">*</span>forwardItem<span class="token punctuation">;</span>
<span class="token comment">//回退的一个网页节点</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> WKBackForwardListItem <span class="token operator">*</span>backItem<span class="token punctuation">;</span>
<span class="token comment">//获取某个index的网页节点</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable WKBackForwardListItem <span class="token operator">*</span><span class="token punctuation">)</span>itemAtIndex<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>index<span class="token punctuation">;</span>
<span class="token comment">//获取回退的节点数组</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSArray<span class="token operator">&lt;</span>WKBackForwardListItem <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span>backList<span class="token punctuation">;</span>
<span class="token comment">//获取前进的节点数组</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSArray<span class="token operator">&lt;</span>WKBackForwardListItem <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span>forwardList<span class="token punctuation">;</span>
<span class="token keyword">@end</span>
</code></pre></div><p>在 WebKit 中，网页节点被抽象成为了 WKBackForwardListItem 类，这个类中封装的属性如下：</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token keyword">@interface</span> WKBackForwardListItem <span class="token punctuation">:</span> NSObject
<span class="token comment">//当前节点的URL</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSURL <span class="token operator">*</span>URL<span class="token punctuation">;</span>
<span class="token comment">//当前节点的标题</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSString <span class="token operator">*</span>title<span class="token punctuation">;</span>
<span class="token comment">//创建此WebView的初始URL</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSURL <span class="token operator">*</span>initialURL<span class="token punctuation">;</span>
</code></pre></div><h2 id="native-与-javascript-交互"><a href="#native-与-javascript-交互" class="header-anchor">#</a> Native 与 JavaScript 交互</h2> <p>WebKit中的 Native 与 JavaScript 的交互主要有4类。</p> <p>1.JavaScript调用native方法</p> <p>这种方式是由 WKUserContentController 注册，并在代理方法中实现的。</p> <p>2.native调用JavaScript方法</p> <p>这种方式通过 WKWebView 直接调用 evaluteJavaScript:completionHandler: 方法来实现。</p> <p>3.将 JavaScript 代码注入</p> <p>这种方式可以在网页中注入一些自定义的 JavaScript 代码，也可以注入自定义的方法，再使用<code>evaluteJavaScript:completionHandler:</code>来调用方法。JavaScript 代码的注入也是通过 WKUserContentController 来完成的，使用 addUserScript: 方法来注入 JavaScript，其中需要通过WKUserScript 类来生成要注入的对象，这个类使用如下方法来进行实例化：</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">/*
source为要注入的js代码
WKUserScriptInjectionTime 设置注入的时机
forMainFrameOnly 参数设置是否只在主页面注入
typedef NS_ENUM(NSInteger, WKUserScriptInjectionTime) {
    // 原js代码运行前注入
    WKUserScriptInjectionTimeAtDocumentStart,
    // 原js代码运行后注入
    WKUserScriptInjectionTimeAtDocumentEnd
} NS_ENUM_AVAILABLE(10_10, 8_0);

*/</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>initWithSource<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>source injectionTime<span class="token punctuation">:</span><span class="token punctuation">(</span>WKUserScriptInjectionTime<span class="token punctuation">)</span>injectionTime forMainFrameOnly<span class="token punctuation">:</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>forMainFrameOnly<span class="token punctuation">;</span>
</code></pre></div><p>4.WKUIDelegate 来交互</p> <p>这种方式主要用于相应 JavaScript 中的弹出框，后面会详细介绍这个协议。</p> <h2 id="wkuidelegate-协议中方法解析"><a href="#wkuidelegate-协议中方法解析" class="header-anchor">#</a> WKUIDelegate 协议中方法解析</h2> <p>WebKit考虑web页面的各种弹出框样式，如alert弹出框、Confirm选择框和TextInput输入框。WebKit为了让我们开发人员可以根据自己APP的风格设计各种不同的样式。对这些弹出框进行了封装。</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//创建新的webView时调用的方法</span>
<span class="token operator">-</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView createWebViewWithConfiguration<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebViewConfiguration <span class="token operator">*</span><span class="token punctuation">)</span>configuration forNavigationAction<span class="token punctuation">:</span><span class="token punctuation">(</span>WKNavigationAction <span class="token operator">*</span><span class="token punctuation">)</span>navigationAction windowFeatures<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWindowFeatures <span class="token operator">*</span><span class="token punctuation">)</span>windowFeatures<span class="token punctuation">{</span>
    <span class="token keyword">return</span> webView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//关闭webView时调用的方法</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webViewDidClose<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token comment">//下面这些方法是交互JavaScript的方法</span>
<span class="token comment">//JavaScript调用alert方法后回调的方法 message中为alert提示的信息 必须要在其中调用completionHandler()</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView runJavaScriptAlertPanelWithMessage<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>message initiatedByFrame<span class="token punctuation">:</span><span class="token punctuation">(</span>WKFrameInfo <span class="token operator">*</span><span class="token punctuation">)</span>frame completionHandler<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span>completionHandler<span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%@&quot;</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">completionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//JavaScript调用confirm方法后回调的方法 confirm是js中的确定框，需要在block中把用户选择的情况传递进去</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView runJavaScriptConfirmPanelWithMessage<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>message initiatedByFrame<span class="token punctuation">:</span><span class="token punctuation">(</span>WKFrameInfo <span class="token operator">*</span><span class="token punctuation">)</span>frame completionHandler<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span><span class="token punctuation">)</span>completionHandler<span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%@&quot;</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">completionHandler</span><span class="token punctuation">(</span>YES<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//JavaScript调用prompt方法后回调的方法 prompt 是 js 中的输入框 需要在 block 中把用户输入的信息传入</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView runJavaScriptTextInputPanelWithPrompt<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>prompt defaultText<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>defaultText initiatedByFrame<span class="token punctuation">:</span><span class="token punctuation">(</span>WKFrameInfo <span class="token operator">*</span><span class="token punctuation">)</span>frame completionHandler<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span> _Nullable<span class="token punctuation">)</span><span class="token punctuation">)</span>completionHandler<span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%@&quot;</span><span class="token punctuation">,</span>prompt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">completionHandler</span><span class="token punctuation">(</span><span class="token string">@&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="wkprocesspool"><a href="#wkprocesspool" class="header-anchor">#</a> WKProcessPool</h2> <p>WKProcessPool 是用于配置进程池的，它与网页视图的资源共享有关。WKProcessPool 这个类中没有暴露任何的属性和方法。</p> <p>配置为同一个进程池的 webView 之间可以共享数据（例如 cookie、localStorage 等）。</p> <p>每一个 webView 都会有自己的一个 web 内容进程，这些进程会被放进 config 配置的 processPool 中，处于同一个 processPool 中的 web 内容进程之间会共享。但是 processPool 中的进程会有限制，一旦达到该限制，processPool 中的 web 内容进程之间将会停止共享。</p> <p>WKWebView WKProcessPool 实例在 app 杀进程重启后会被重置，导致 WKProcessPool 中的 Cookie、session Cookie 数据丢失，目前也无法实现 WKProcessPool 实例本地化保存。</p> <h2 id="wknavagationdelegate-中方法解析"><a href="#wknavagationdelegate-中方法解析" class="header-anchor">#</a> WKNavagationDelegate 中方法解析</h2> <p>WKNavagationDelegate 协议重要有两个作用，监听页面渲染流程与控制页面跳转，其中方法如下：</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">/*
决定是否响应网页的某个动作，例如加载，回退，前进，刷新等，在这个方法中，必须执行decisionHandler()代码块，并将是否允许这个活动执行在block中进行传入
*/</span>
<span class="token comment">/*
WKNavigationAction是网页动作的抽象化，其中封装了许多行为信息，后面会介绍
WKNavigationActionPolicy为开发者回执，枚举如下：
typedef NS_ENUM(NSInteger, WKNavigationActionPolicy) {
    //取消此次行为
    WKNavigationActionPolicyCancel,
    //允许此次行为
    WKNavigationActionPolicyAllow,
} NS_ENUM_AVAILABLE(10_10, 8_0);
*/</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView decidePolicyForNavigationAction<span class="token punctuation">:</span><span class="token punctuation">(</span>WKNavigationAction <span class="token operator">*</span><span class="token punctuation">)</span>navigationAction decisionHandler<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span>WKNavigationActionPolicy<span class="token punctuation">)</span><span class="token punctuation">)</span>decisionHandler<span class="token punctuation">{</span>
    <span class="token function">decisionHandler</span><span class="token punctuation">(</span>WKNavigationActionPolicyAllow<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//需要响应身份验证时调用 同样在block中需要传入用户身份凭证</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView didReceiveAuthenticationChallenge<span class="token punctuation">:</span><span class="token punctuation">(</span>NSURLAuthenticationChallenge <span class="token operator">*</span><span class="token punctuation">)</span>challenge completionHandler<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span>NSURLSessionAuthChallengeDisposition<span class="token punctuation">,</span> NSURLCredential <span class="token operator">*</span> _Nullable<span class="token punctuation">)</span><span class="token punctuation">)</span>completionHandler<span class="token punctuation">{</span>
    <span class="token comment">//用户身份信息</span>
    NSURLCredential <span class="token operator">*</span>newCred <span class="token operator">=</span> <span class="token punctuation">[</span>NSURLCredential credentialWithUser<span class="token punctuation">:</span><span class="token string">@&quot;&quot;</span>
                                                          password<span class="token punctuation">:</span><span class="token string">@&quot;&quot;</span>
                                                       persistence<span class="token punctuation">:</span>NSURLCredentialPersistenceNone<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 为 challenge 的发送方提供 credential</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>challenge sender<span class="token punctuation">]</span> useCredential<span class="token punctuation">:</span>newCred
           forAuthenticationChallenge<span class="token punctuation">:</span>challenge<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">completionHandler</span><span class="token punctuation">(</span>NSURLSessionAuthChallengeUseCredential<span class="token punctuation">,</span>newCred<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//接收到数据后是否允许执行渲染</span>
<span class="token comment">/*
其中，WKNavigationResponse为请求回执信息
WKNavigationResponsePokicy为开发者回执，枚举如下：
typedef NS_ENUM(NSInteger, WKNavigationResponsePolicy) {
    //取消渲染
    WKNavigationResponsePolicyCancel,
    //允许渲染
    WKNavigationResponsePolicyAllow,
} NS_ENUM_AVAILABLE(10_10, 8_0);
*/</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView decidePolicyForNavigationResponse<span class="token punctuation">:</span><span class="token punctuation">(</span>WKNavigationResponse <span class="token operator">*</span><span class="token punctuation">)</span>navigationResponse decisionHandler<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span>WKNavigationResponsePolicy<span class="token punctuation">)</span><span class="token punctuation">)</span>decisionHandler<span class="token punctuation">{</span>
    <span class="token function">decisionHandler</span><span class="token punctuation">(</span>WKNavigationResponsePolicyAllow<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//=====================下面这个协议方法用于监听流程=========================================</span>
<span class="token comment">//页面加载启动时调用</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView didStartProvisionalNavigation<span class="token punctuation">:</span><span class="token punctuation">(</span>WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>navigation<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token comment">//当主机接收到的服务重定向时调用</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView didReceiveServerRedirectForProvisionalNavigation<span class="token punctuation">:</span><span class="token punctuation">(</span>WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>navigation<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token comment">//内容到达主机时调用</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView didCommitNavigation<span class="token punctuation">:</span><span class="token punctuation">(</span>WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>navigation<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token comment">//主页加载完成时调用</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView didFinishNavigation<span class="token punctuation">:</span><span class="token punctuation">(</span>WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>navigation<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token comment">//提交发生错误时调用</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView didFailNavigation<span class="token punctuation">:</span><span class="token punctuation">(</span>WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>navigation withError<span class="token punctuation">:</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span><span class="token punctuation">)</span>error<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token comment">//主页数据加载发生错误时调用</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView didFailProvisionalNavigation<span class="token punctuation">:</span><span class="token punctuation">(</span>null_unspecified WKNavigation <span class="token operator">*</span><span class="token punctuation">)</span>navigation withError<span class="token punctuation">:</span><span class="token punctuation">(</span>nonnull NSError <span class="token operator">*</span><span class="token punctuation">)</span>error<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token comment">//进程被终止时调用</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webViewWebContentProcessDidTerminate<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="扩展"><a href="#扩展" class="header-anchor">#</a> 扩展</h2> <p>首先，在注册要被 JavaScript 调用的方法时需要设置代理，在不需要时需要将代理移除，WKUserContentController中也提供了移除这个代理的方法，如果不移除，将会造成 WebView 不能释放。</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//注册一个监听方法</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>addScriptMessageHandler<span class="token punctuation">:</span><span class="token punctuation">(</span>id <span class="token operator">&lt;</span>WKScriptMessageHandler<span class="token operator">&gt;</span><span class="token punctuation">)</span>scriptMessageHandler name<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>name<span class="token punctuation">;</span>
<span class="token comment">//移除一个方法的监听</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>removeScriptMessageHandlerForName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>name<span class="token punctuation">;</span>
</code></pre></div><p>同样与注入 JavaScript 对应，也可以将注入的代码移除，方法如下：</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//注入一个JavaScript抽象对象</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>addUserScript<span class="token punctuation">:</span><span class="token punctuation">(</span>WKUserScript <span class="token operator">*</span><span class="token punctuation">)</span>userScript<span class="token punctuation">;</span>
<span class="token comment">//移除所有注入</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>removeAllUserScripts<span class="token punctuation">;</span>
</code></pre></div><p>在上面，经常会见到 WKNavagationAction 这个类，这个类中封装的是一些页面活动信息，如下：</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token keyword">@interface</span> WKNavigationAction <span class="token punctuation">:</span> NSObject
<span class="token comment">//原页面</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> WKFrameInfo <span class="token operator">*</span>sourceFrame<span class="token punctuation">;</span>
<span class="token comment">//目标页面</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> WKFrameInfo <span class="token operator">*</span>targetFrame<span class="token punctuation">;</span>
<span class="token comment">//请求URL</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSURLRequest <span class="token operator">*</span>request<span class="token punctuation">;</span>
<span class="token comment">//活动类型</span>
<span class="token comment">/*
typedef NS_ENUM(NSInteger, WKNavigationType) {
    //链接激活
    WKNavigationTypeLinkActivated,
    //提交操作
    WKNavigationTypeFormSubmitted,
    //前进操作
    WKNavigationTypeBackForward,
    //刷新操作
    WKNavigationTypeReload,
    //重提交操作 例如前进 后退 刷新
    WKNavigationTypeFormResubmitted,
    //其他类型
    WKNavigationTypeOther = -1,
} NS_ENUM_AVAILABLE(10_10, 8_0);
*/</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">)</span> WKNavigationType navigationType<span class="token punctuation">;</span>
<span class="token keyword">@end</span>
</code></pre></div><h2 id="wkwebview-共享-cookie"><a href="#wkwebview-共享-cookie" class="header-anchor">#</a> WKWebview 共享 Cookie</h2> <p>很多 Hybrid 框架迭代到 WKWebview 后就可以出现关于 Cookie 共享的一些问题，这些问题无外乎就两点：</p> <ol><li>原生请求（NSURLSessionDataTask、AFNetworking等和）WKWebview 之间 cookie 的共享</li> <li>不同 WKWebview (包括webview内的ajax请求) 之间 Cookie 的共享</li></ol> <h3 id="产生这个问题的原因是什么"><a href="#产生这个问题的原因是什么" class="header-anchor">#</a> 产生这个问题的原因是什么？</h3> <p>NSHTTPCookieStorage 是一个单例，用来管理整个项目的 Cookie，包括 UIWebview 的Cookie也是由其管理，因此在使用UIWebview的情况下是没有任何问题的。但是WKWebview的Cookie信息并不存储在NSHTTPCookieStorage中，其由 WKProcessPool 管理。</p> <h3 id="多wkwebview间cookie的共享"><a href="#多wkwebview间cookie的共享" class="header-anchor">#</a> 多WKWebview间Cookie的共享</h3> <p>先来看WKWebview之间Cookie的共享问题如何解决</p> <p><strong>方法一</strong></p> <p>默认情况下，每一个WKWebview对象持有一个WKProcessPool对象，因此可以通过单例化WKProcessPool的方式解决WKWebview间Cookie共享的问题，但是存在的问题是WKProcessPool不会被持久化，应用被杀死后会导致Cookie丢失，对于需要长久保存的Cookie并不合适。</p> <p><strong>方法二</strong></p> <p>使用NSHTTPCookieStorage对象去手动存取Cookie信息并注入到WKWebview中。先来说怎么取：</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView decidePolicyForNavigationResponse<span class="token punctuation">:</span><span class="token punctuation">(</span>WKNavigationResponse <span class="token operator">*</span><span class="token punctuation">)</span>navigationResponse decisionHandler<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span>WKNavigationResponsePolicy<span class="token punctuation">)</span><span class="token punctuation">)</span>decisionHandler<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">@</span><span class="token function">available</span><span class="token punctuation">(</span>iOS <span class="token number">12.0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        WKHTTPCookieStore <span class="token operator">*</span>cookieStore <span class="token operator">=</span> webView<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span>websiteDataStore<span class="token punctuation">.</span>httpCookieStore<span class="token punctuation">;</span>
        <span class="token punctuation">[</span>cookieStore getAllCookies<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSArray<span class="token operator">*</span> cookies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">[</span><span class="token keyword">self</span> setCookie<span class="token punctuation">:</span>cookies<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        NSHTTPURLResponse <span class="token operator">*</span>response <span class="token operator">=</span> <span class="token punctuation">(</span>NSHTTPURLResponse <span class="token operator">*</span><span class="token punctuation">)</span>navigationResponse<span class="token punctuation">.</span>response<span class="token punctuation">;</span>
        NSArray <span class="token operator">*</span>cookies <span class="token operator">=</span><span class="token punctuation">[</span>NSHTTPCookie cookiesWithResponseHeaderFields<span class="token punctuation">:</span><span class="token punctuation">[</span>response allHeaderFields<span class="token punctuation">]</span> forURL<span class="token punctuation">:</span>response<span class="token punctuation">.</span>URL<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> setCookie<span class="token punctuation">:</span>cookies<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">decisionHandler</span><span class="token punctuation">(</span>WKNavigationResponsePolicyAllow<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>setCookie<span class="token punctuation">:</span><span class="token punctuation">(</span>NSArray <span class="token operator">*</span><span class="token punctuation">)</span>cookies <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>NSHTTPCookie <span class="token operator">*</span>cookie <span class="token keyword">in</span> cookies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        NSHTTPCookie <span class="token operator">*</span>httpCookie <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span> fixExpiresDateWithCookie<span class="token punctuation">:</span>cookie<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span>NSHTTPCookieStorage sharedHTTPCookieStorage<span class="token punctuation">]</span> setCookie<span class="token punctuation">:</span>httpCookie<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>NSHTTPCookie <span class="token operator">*</span><span class="token punctuation">)</span>fixExpiresDateWithCookie<span class="token punctuation">:</span><span class="token punctuation">(</span>NSHTTPCookie <span class="token operator">*</span><span class="token punctuation">)</span>cookie<span class="token punctuation">{</span>
    NSMutableDictionary <span class="token operator">*</span>propertiesDic <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>cookie properties<span class="token punctuation">]</span> mutableCopy<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">[</span>propertiesDic valueForKey<span class="token punctuation">:</span><span class="token string">@&quot;expiresDate&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        propertiesDic<span class="token punctuation">[</span>NSHTTPCookieExpires<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>NSDate dateWithTimeIntervalSinceNow<span class="token punctuation">:</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        propertiesDic<span class="token punctuation">[</span>NSHTTPCookieDiscard<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    NSHTTPCookie <span class="token operator">*</span>newCookie <span class="token operator">=</span> <span class="token punctuation">[</span>NSHTTPCookie cookieWithProperties<span class="token punctuation">:</span>propertiesDic<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> newCookie<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代码比较简单，唯一需要注意的就是fixExpiresDateWithCookie这个方法的实现中修改了Cookie的过期时间NSHTTPCookieExpires与是否丢弃NSHTTPCookieDiscard字段，修改原因是因为后端不愿意改代码，喝喝，当然也可以理解，B/S架构中session-only=1这样的设置较为安全，也是常态化操作，但是对于客户端多个webview对象就很尴尬了。同时这个操作的确可能带了信息泄露的安全问题，安全风险一定需要注意</p> <p>接下来说怎么注入到WKWebview中去，有两种思路：</p> <p><strong>第一种</strong>是通过WKUserScript去注入，但是注入时机会影响服务器可能拿不到Cookie。</p> <p><strong>第二种</strong>方法是在构造NSURLRequest的时候去修改请求头，也直接上代码了：</p> <div class="language-objc extra-class"><pre class="language-objc"><code>NSMutableURLRequest <span class="token operator">*</span>request <span class="token operator">=</span> <span class="token punctuation">[</span>NSMutableURLRequest requestWithURL<span class="token punctuation">:</span>url cachePolicy<span class="token punctuation">:</span>NSURLRequestUseProtocolCachePolicy timeoutInterval<span class="token punctuation">:</span><span class="token number">20.0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
NSMutableString <span class="token operator">*</span>cookiesString <span class="token operator">=</span> <span class="token punctuation">[</span>NSMutableString string<span class="token punctuation">]</span><span class="token punctuation">;</span>
NSArray <span class="token operator">*</span>tmpCookies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSHTTPCookieStorage sharedHTTPCookieStorage<span class="token punctuation">]</span> cookiesForURL<span class="token punctuation">:</span>url<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span>NSHTTPCookie <span class="token operator">*</span> cookie <span class="token keyword">in</span> tmpCookies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    NSString <span class="token operator">*</span>cookieString <span class="token operator">=</span> <span class="token punctuation">[</span>NSString stringWithFormat<span class="token punctuation">:</span><span class="token string">@&quot;%@=%@;&quot;</span><span class="token punctuation">,</span>cookie<span class="token punctuation">.</span>name<span class="token punctuation">,</span>cookie<span class="token punctuation">.</span>value<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>cookiesString appendString<span class="token punctuation">:</span>cookieString<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>request setValue<span class="token punctuation">:</span>cookiesString forHTTPHeaderField<span class="token punctuation">:</span><span class="token string">@&quot;Cookie&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token keyword">self</span> loadRequest<span class="token punctuation">:</span>request<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="原生请求与wkwebview之间cookie的共享"><a href="#原生请求与wkwebview之间cookie的共享" class="header-anchor">#</a> 原生请求与WKWebview之间Cookie的共享</h3> <p>获取和保存Cookie的方式与上面类似，再处理网络请求response的地方调用如下类似代码：</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>syncSwordCookies<span class="token punctuation">:</span><span class="token punctuation">(</span>NSURLResponse <span class="token operator">*</span><span class="token punctuation">)</span>response forURL<span class="token punctuation">:</span><span class="token punctuation">(</span>NSURL <span class="token operator">*</span><span class="token punctuation">)</span>url <span class="token punctuation">{</span>
    NSDictionary <span class="token operator">*</span>respHeader <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>NSHTTPURLResponse <span class="token operator">*</span><span class="token punctuation">)</span>response allHeaderFields<span class="token punctuation">]</span><span class="token punctuation">;</span>
    NSArray <span class="token operator">*</span>cookies <span class="token operator">=</span> <span class="token punctuation">[</span>NSHTTPCookie cookiesWithResponseHeaderFields<span class="token punctuation">:</span>respHeader forURL<span class="token punctuation">:</span>url<span class="token punctuation">]</span><span class="token punctuation">;</span>
    NSHTTPCookieStorage <span class="token operator">*</span>cookieStorage <span class="token operator">=</span> <span class="token punctuation">[</span>NSHTTPCookieStorage sharedHTTPCookieStorage<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>NSHTTPCookie <span class="token operator">*</span>cookie <span class="token keyword">in</span> cookies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>cookieStorage setCookie<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token keyword">self</span> fixExpiresDateWithCookie<span class="token punctuation">:</span>cookie<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Cookie都保存在NSHTTPCookieStorage中后，原生请求自动共享Cookie，webview注入方式即与前面说的WKWebview一样的，就不用赘述了，但是唯一要注意的地方就是 NSHTTPCookieStorage 保存有一个耗时时间，大概零点几秒，不能在保存后立刻去同步到WKWebview中去，否则容易取不到 Cookie。</p> <h3 id="app进程的cookie和webprocess进程的cookie如何同步"><a href="#app进程的cookie和webprocess进程的cookie如何同步" class="header-anchor">#</a> App进程的Cookie和WebProcess进程的Cookie如何同步？</h3> <p>因为在iOS 11之后，WKWebView统一使用WKHTTPCookieStore来管理Cookie, 而WKHTTPCookieStore 提供了 WKHTTPCookieStoreObserver 来监听Cookie的变化。</p> <p>这样的话，我们就可以在监听到 WKWebViewCookie 发生变化的时候，将Cookie同步到App进程。</p> <p>这样的话，我们就可以在监听到WKWebViewCookie发生变化的时候，将Cookie同步到App进程。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">setupWebView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    webView<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span>websiteDataStore<span class="token punctuation">.</span>httpCookieStore<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// WKHTTPCookieStoreObserver协议的方法</span>
<span class="token keyword">func</span> <span class="token function-definition function">cookiesDidChange</span><span class="token punctuation">(</span><span class="token keyword">in</span> cookieStore<span class="token punctuation">:</span> <span class="token class-name">WKHTTPCookieStore</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cookieStore<span class="token punctuation">.</span>getAllCookies <span class="token punctuation">{</span> array <span class="token keyword">in</span>
        array<span class="token punctuation">.</span>forEach <span class="token punctuation">{</span>
            <span class="token class-name">HTTPCookieStorage</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>值得注意的是，这样的话，两种不同进程的Cookie都会持久化到本地。所以如果要HTTPCookieStorage的Cookie不持久化到本地的话，可以添加“discard”字段在HTTPCookie中，这也就是相当于设置“sessionOnly”属性了。</p> <h3 id="app进程的cookie如何同步到webprocess呢"><a href="#app进程的cookie如何同步到webprocess呢" class="header-anchor">#</a> App进程的Cookie如何同步到WebProcess呢？</h3> <p>这个时候假设一个场景：App客户端请求了一个URL，服务器收到之后使用了Set-Cookies，当App客户端收到服务器的Response之后，需要把Cookies同步到WKWebView，那么如何实现呢？</p> <p>可以采用淘宝技术分享中提到的解决方案：
我们可以通过 HOOK NSHTTPCookieStorage 中读写 Cookie 的接口，并且监听网络请求中 &quot;Set-Cookie&quot; 关键字，在 App 进程 Cookie 发生变化时同步到 WKWebView。</p> <h3 id="nshttpcookiestorage与wkhttpcookiestore的同步问题"><a href="#nshttpcookiestorage与wkhttpcookiestore的同步问题" class="header-anchor">#</a> NSHTTPCookieStorage与WKHTTPCookieStore的同步问题</h3> <p>首先明确一点，系统确实做了NSHTTPCookieStorage与WKHTTPCookieStore的同步，但是由于WKHTTPCookieStore的cookie操作都是在异步线程，所以从NSHTTPCookieStoreage同步到WKHTTPCookieStore时，会遇到两个问题：</p> <ol><li>同步时机不确定</li> <li>同步任务在异步线程</li></ol> <p>举个简单的列子：NSHTTPCookieStoreage对URL1新增/修改cookie1后，立刻使webView打开URL1，那么webView的请求时无法获取到新增/修改后的cookie1的。</p> <ul><li><p>从WKHTTPCookieStore同步到NSHTTPCookieStorage的cookie操作，都是安全的，及时的，因为NSHTTPCookieStorage的cookie操作在主线程操作</p></li> <li><p>从NSHTTPCookieStorage同步到WKHTTPCookieStore的cookie操作，是不安全的，不及时的，因为WKHTTPCookieStore的cookie操作都为异步线程且时机也是无法控制的</p></li></ul> <h3 id="cookie同步方案"><a href="#cookie同步方案" class="header-anchor">#</a> Cookie同步方案</h3> <p>iOS 11系统官方提供了同步 Cookie 的API，故 iOS 11 系统前后区分处理。</p> <p>iOS 11 及之后的系统可通过 WKHTTPCookieStore 来管理 HTTP Cookie 信息，WKHTTPCookieStore 存储在 WKWebsiteDataStore 中，关系如下：</p> <div class="language- extra-class"><pre class="language-text"><code>WKWebViewConfiguration -&gt; WKWebsiteDataStore -&gt; WKHTTPCookieStore
</code></pre></div><p>综上我们有两个时机去设置 Cookie，一个是初始化 WKWebview 时，一个是发起请求时。注意 WKHTTPCookieStore 设置 Cookie 是一个异步的操作，所以在页面初始化时设置 Cookie 会存在发起请求时，Cookie 没有全部设置完毕的情况。</p> <p>较好的方案为在 loadRequest 时，先设置 Cookie ，在设置成功的回调中再发起网络请求。</p> <ul><li><a href="https://github.com/ChenYilong/iOSBlog/issues/14" target="_blank" rel="nofollow noopener noreferrer">iOS 防 DNS 污染方案调研（四）--- Cookie 业务场景<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/428118929" target="_blank" rel="nofollow noopener noreferrer">干货：探秘WKWebView<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="wkwebview-拦截请求技术调研"><a href="#wkwebview-拦截请求技术调研" class="header-anchor">#</a> WKWebView 拦截请求技术调研</h2> <p>业内已有的 WKWebView 请求拦截方案，主要分为如下两种</p> <ul><li>NSURLProtocol</li> <li>WKURLSchemeHandler</li></ul> <h3 id="nsurlprotocol"><a href="#nsurlprotocol" class="header-anchor">#</a> NSURLProtocol</h3> <p>NSURLProtocol 默认会拦截所有经过 URL Loading System 的请求，因此只要 WKWebView 发出的请求经过 URL Loading System 就可以被拦截。经过我们的尝试，发现 WKWebView 独立于应用进程运行，发出去的请求默认是不会经过 URL Loading System，需要我们额外进行 hook 才能支持，具体实时可参考：<a href="https://www.jianshu.com/p/8f5e1082f5e0" target="_blank" rel="nofollow noopener noreferrer">NSURLProtocol对WKWebView的处理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>虽然NSURLProtocol可以拦截监听每一个URL Loading System中发出request请求，记住是 URL Loading System 中那些类发出的请求，也支持AFNetwoking，UIWebView发出的 request，NSURLProtocol 都可以拦截和监听。</p> <p>因为 WKWebView 在独立进程里执行网络请求。一旦注册 http(s) scheme 后，网络请求将从 Network Process 发送到 App Process，这样 NSURLProtocol 才能拦截网络请求。</p> <p>但是在 WebKit2 的设计里使用 MessageQueue 进行进程之间的通信，Network Process 会将请求 encode 成一个 Message，然后通过 IPC（进程间通信） 发送给 App Process。出于性能的原因，encode 的时候 <strong>将HTTPBody 和 HTTPBodyStream 这两个字段丢弃掉</strong>(坑)</p> <p>因此，如果通过<code>registerSchemeForCustomProtocol</code>注册了 http(s) scheme, 那么由 WKWebView 发起的所有 http(s)请求都会通过 IPC 传给主进程 NSURLProtocol 处理，导致 post 请求 body 被清空。</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//苹果开源的 WebKit2 源码暴露了私有API：</span>
<span class="token operator">+</span> <span class="token punctuation">[</span>WKBrowsingContextController registerSchemeForCustomProtocol<span class="token punctuation">:</span><span class="token punctuation">]</span>

<span class="token comment">//通过注册 http(s) scheme 后 WKWebView 将可以使用 NSURLProtocol 拦截 http(s) 请求：</span>
Class cls <span class="token operator">=</span> <span class="token function">NSClassFromString</span><span class="token punctuation">(</span><span class="token operator">@</span>&quot;WKBrowsingContextController”<span class="token punctuation">)</span><span class="token punctuation">;</span>
 SEL sel <span class="token operator">=</span> <span class="token function">NSSelectorFromString</span><span class="token punctuation">(</span><span class="token string">@&quot;registerSchemeForCustomProtocol:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>cls respondsToSelector<span class="token punctuation">:</span>sel<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token comment">// 注册http(s) scheme, 把 http和https请求交给 NSURLProtocol处理 </span>
        <span class="token punctuation">[</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>cls performSelector<span class="token punctuation">:</span>sel withObject<span class="token punctuation">:</span><span class="token string">@&quot;http&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
        <span class="token punctuation">[</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>cls performSelector<span class="token punctuation">:</span>sel withObject<span class="token punctuation">:</span><span class="token string">@&quot;https&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>说明1：名目张胆使用私有API，是过不了AppStore审核的，具体使用什么办法，想来你也懂(hun xiao)。</p> <p>说明2：一旦打开ATS开关：Allow Arbitrary Loads 选项设置为NO，通过 registerSchemeForCustomProtocol 注册了 http(s) scheme，WKWebView 发起的所有 http(s) 网络请求将被阻塞（即便将Allow Arbitrary Loads in Web Content 选项设置为YES）；</p> <p>说明3：iOS11之后可以通过WKURLSchemeHandler去完成对WKWebView的请求拦截,不需要再调用私有API解决上述问题了。</p> <h3 id="wkurlschemehandler"><a href="#wkurlschemehandler" class="header-anchor">#</a> WKURLSchemeHandler</h3> <p>WKURLSchemeHandler是iOS11就推出的，用于处理自定义请求的方案，不过并不能处理Http、Https等常规scheme。</p> <p>WKURLSchemeHandler 负责自定义请求的数据管理，如果需要支持 scheme 为 http 或 https请求的数据管理则需要 hook WKWebView 的 handlesURLScheme: 方法，然后返回 NO 即可：</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>load <span class="token punctuation">{</span>
    <span class="token keyword">static</span> dispatch_once_t onceToken<span class="token punctuation">;</span>
    <span class="token function">dispatch_once</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>onceToken<span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
        Method originalMethod1 <span class="token operator">=</span> <span class="token function">class_getClassMethod</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token keyword">@selector</span><span class="token punctuation">(</span>handlesURLScheme<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Method swizzledMethod1 <span class="token operator">=</span> <span class="token function">class_getClassMethod</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token keyword">@selector</span><span class="token punctuation">(</span>yyhandlesURLScheme<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">method_exchangeImplementations</span><span class="token punctuation">(</span>originalMethod1<span class="token punctuation">,</span> swizzledMethod1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">+</span> <span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>yyhandlesURLScheme<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>urlScheme <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>urlScheme isEqualToString<span class="token punctuation">:</span><span class="token string">@&quot;http&quot;</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span>urlScheme isEqualToString<span class="token punctuation">:</span><span class="token string">@&quot;https&quot;</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span>urlScheme isEqualToString<span class="token punctuation">:</span><span class="token string">@&quot;file&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> NO<span class="token punctuation">;</span>  <span class="token comment">//这里让返回NO,应该是默认不走系统断言或者其他判断啥的</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">self</span> handlesURLScheme<span class="token punctuation">:</span>urlScheme<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>隔离性：NSURLProtocol 一经注册就是全局开启。一般来讲我们只会拦截自己的业务页面，但使用了 NSURLProtocol 的方式后会导致应用内合作的三方页面也会被拦截从而被污染。WKURLSchemeHandler 则可以以页面为维度进行隔离，因为是跟随着 WKWebViewConfiguration 进行配置。</li> <li>稳定性：NSURLProtocol 拦截过程中会丢失 Body，WKURLSchemeHandler 在 iOS 11.3 之前 (不包含) 也会丢失 Body，在 iOS 11.3 以后 WebKit 做了优化只会丢失 Blob 类型数据。</li> <li>一致性：WKWebView 发出的请求被 NSURLProtocol 拦截后行为可能发生改变，比如想取消 video 标签的视频加载一般都是将资源地址 (src) 设置为空，但此时 stopLoading 方法却不会调用，相比而言 WKURLSchemeHandler 表现正常。</li></ul> <p>WKURLSchemeHandler 在隔离性、稳定性、一致性上表现优于 NSURLProtocol，但是想在生产环境投入使用必须要解决 Body 丢失的问题。</p> <p><strong>WKWebView自定义资源 scheme</strong></p> <ul><li><p>向WKWebView 注册 customScheme, 比如 dynamic://, 而不是https或http，避免对https或http请求的影响。</p></li> <li><p>保证使用离线包功能的请求，没有post方式，遇到customScheme请求，比如dynamic://www.dynamicalbumlocalimage.com/，通过 NSURLProtocol 拦截这个请求并加载离线数据。</p></li> <li><p>iOS 11上, WebKit 提供的WKURLSchemeHandler可实现拦截，需要注意的只允许开发者拦截自定义 Scheme 的请求，不允许拦截 “http”、“https”、“ftp”、“file” 等的请求，否则会crash。</p></li> <li><p>重定向问题，WKURLSchemeHandler 在获取数据时<strong>并不支持重定向</strong></p></li></ul></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">9/10/2024, 2:44:25 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/swift/ios/XCFramework.html" class="prev">
          XCFramework
        </a></span> <!----></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#快速使用" class="sidebar-link reco-side-快速使用" data-v-b57cc07c>快速使用</a></li><li class="level-2" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#wkwebview-中的属性和方法解析" class="sidebar-link reco-side-wkwebview-中的属性和方法解析" data-v-b57cc07c>WKWebView 中的属性和方法解析</a></li><li class="level-2" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#native-与-javascript-交互" class="sidebar-link reco-side-native-与-javascript-交互" data-v-b57cc07c>Native 与 JavaScript 交互</a></li><li class="level-2" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#wkuidelegate-协议中方法解析" class="sidebar-link reco-side-wkuidelegate-协议中方法解析" data-v-b57cc07c>WKUIDelegate 协议中方法解析</a></li><li class="level-2" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#wkprocesspool" class="sidebar-link reco-side-wkprocesspool" data-v-b57cc07c>WKProcessPool</a></li><li class="level-2" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#wknavagationdelegate-中方法解析" class="sidebar-link reco-side-wknavagationdelegate-中方法解析" data-v-b57cc07c>WKNavagationDelegate 中方法解析</a></li><li class="level-2" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#扩展" class="sidebar-link reco-side-扩展" data-v-b57cc07c>扩展</a></li><li class="level-2" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#wkwebview-共享-cookie" class="sidebar-link reco-side-wkwebview-共享-cookie" data-v-b57cc07c>WKWebview 共享 Cookie</a></li><li class="level-3" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#产生这个问题的原因是什么" class="sidebar-link reco-side-产生这个问题的原因是什么" data-v-b57cc07c>产生这个问题的原因是什么？</a></li><li class="level-3" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#多wkwebview间cookie的共享" class="sidebar-link reco-side-多wkwebview间cookie的共享" data-v-b57cc07c>多WKWebview间Cookie的共享</a></li><li class="level-3" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#原生请求与wkwebview之间cookie的共享" class="sidebar-link reco-side-原生请求与wkwebview之间cookie的共享" data-v-b57cc07c>原生请求与WKWebview之间Cookie的共享</a></li><li class="level-3" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#app进程的cookie和webprocess进程的cookie如何同步" class="sidebar-link reco-side-app进程的cookie和webprocess进程的cookie如何同步" data-v-b57cc07c>App进程的Cookie和WebProcess进程的Cookie如何同步？</a></li><li class="level-3" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#app进程的cookie如何同步到webprocess呢" class="sidebar-link reco-side-app进程的cookie如何同步到webprocess呢" data-v-b57cc07c>App进程的Cookie如何同步到WebProcess呢？</a></li><li class="level-3" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#nshttpcookiestorage与wkhttpcookiestore的同步问题" class="sidebar-link reco-side-nshttpcookiestorage与wkhttpcookiestore的同步问题" data-v-b57cc07c>NSHTTPCookieStorage与WKHTTPCookieStore的同步问题</a></li><li class="level-3" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#cookie同步方案" class="sidebar-link reco-side-cookie同步方案" data-v-b57cc07c>Cookie同步方案</a></li><li class="level-2" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#wkwebview-拦截请求技术调研" class="sidebar-link reco-side-wkwebview-拦截请求技术调研" data-v-b57cc07c>WKWebView 拦截请求技术调研</a></li><li class="level-3" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#nsurlprotocol" class="sidebar-link reco-side-nsurlprotocol" data-v-b57cc07c>NSURLProtocol</a></li><li class="level-3" data-v-b57cc07c><a href="/swift/ios/ios-webkit.html#wkurlschemehandler" class="sidebar-link reco-side-wkurlschemehandler" data-v-b57cc07c>WKURLSchemeHandler</a></li></ul></div></div></div><div class="global-ui"><!----><!----><!----><!----></div></div>
    <script src="/assets/js/app.d0a85ebb.js" defer></script><script src="/assets/js/3.fe443068.js" defer></script><script src="/assets/js/2.333abca7.js" defer></script><script src="/assets/js/1.09331013.js" defer></script><script src="/assets/js/227.e03c1caa.js" defer></script><script src="/assets/js/34.36196d0f.js" defer></script>
  </body>
</html>
